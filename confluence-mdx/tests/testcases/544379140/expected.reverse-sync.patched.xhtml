<h2>Overview</h2><p>QueryPie에서 생성된 각종 감사 로그를 추출하고 csv 파일로 내려받을 수 있는 기능입니다. 장기간에 걸친 로그 등 대용량 파일인 경우에도 안정적인 추출 및 다운로드가 가능합니다. 한 번 생성된 로그 추출 파일은 30일 동안 다운로드가 가능합니다. 추출 지원 로그는 Query Audit, Workflow SQL Request 등 21종입니다. </p><ac:structured-macro ac:macro-id="d584e29c-8e4f-4028-96d5-3483b1f27c54" ac:name="note" ac:schema-version="1"><ac:rich-text-body><p>Audit Log Export 기능 추가에 따라, 각 로그 화면에서 제공되던 ‘Excel File Download’ 버튼은 QueryPie v9.15.0부터 지원이 중단되었습니다.</p></ac:rich-text-body></ac:structured-macro><p><strong>추출 지원 로그 종류 (QueryPie v11.0.0 기준)</strong></p><table ac:local-id="2947c127-97e1-4b3d-82ff-fcecae88fdc1" data-layout="default"><colgroup><col style="width: 498.0px;"/><col style="width: 160.0px;"/><col style="width: 99.0px;"/></colgroup><tbody><tr><th data-highlight-colour="#d9d9d9"><p style="text-align: center;"><strong>Log Type</strong></p></th><th data-highlight-colour="#d9d9d9"><p style="text-align: center;"><strong>Release Version</strong></p></th><th data-highlight-colour="#d9d9d9"><p style="text-align: center;"><strong>Format</strong></p></th></tr><tr><td><p>Workflow DB Access Request</p></td><td><p></p></td><td><p>CSV</p></td></tr><tr><td><p>Workflow SQL Request</p></td><td><p></p></td><td><p>CSV</p></td></tr><tr><td><p>Workflow SQL Request for Query Details</p></td><td><p></p></td><td><p>CSV</p></td></tr><tr><td><p>Workflow SQL Export Request</p></td><td><p></p></td><td><p>CSV</p></td></tr><tr><td><p>Workflow Restricted Data Access Request</p></td><td><p>11.0.0</p></td><td><p>JSON</p></td></tr><tr><td><p>Workflow DB Policy Exception Request</p></td><td><p>11.0.0</p></td><td><p>JSON</p></td></tr><tr><td><p>Workflow Unmasking Request</p></td><td><p>11.0.0</p></td><td><p>JSON</p></td></tr><tr><td><p>Workflow Decryption Request</p></td><td><p>10.3.0</p></td><td><p>JSON</p></td></tr><tr><td><p>Workflow Server Access Request</p></td><td><p></p></td><td><p>JSON</p></td></tr><tr><td><p>Workflow Server Privilege Request</p></td><td><p>11.3.0</p></td><td><p>JSON</p></td></tr><tr><td><p>Workflow Access Role Request</p></td><td><p>10.0.0</p></td><td><p>CSV</p></td></tr><tr><td><p>IP Registration Request</p></td><td><p>11.0.0</p></td><td><p>JSON</p></td></tr><tr><td><p>User Access History</p></td><td><p></p></td><td><p>CSV</p></td></tr><tr><td><p>Admin Role History</p></td><td><p></p></td><td><p>CSV</p></td></tr><tr><td><p>Activity Logs</p></td><td><p></p></td><td><p>JSON</p></td></tr><tr><td><p>Alert Logs</p></td><td><p>10.3.0</p></td><td><p>JSON</p></td></tr><tr><td><p>Query Audit</p></td><td><p></p></td><td><p>CSV</p></td></tr><tr><td><p>DB Access History</p></td><td><p></p></td><td><p>CSV</p></td></tr><tr><td><p>DB Account Lock History</p></td><td><p></p></td><td><p>CSV</p></td></tr><tr><td><p>DB Access Control Logs</p></td><td><p></p></td><td><p>CSV</p></td></tr><tr><td><p>DML Snapshot</p></td><td><p></p></td><td><p>JSON</p></td></tr><tr><td><p>Restricted Data Access Logs (Legacy)</p></td><td><p>10.3.0</p></td><td><p>JSON</p></td></tr><tr><td><p>Masked Data Access Logs (Legacy)</p></td><td><p>10.3.0</p></td><td><p>JSON</p></td></tr><tr><td><p>Sensitive Data Access Logs (Legacy)</p></td><td><p>10.3.0</p></td><td><p>JSON</p></td></tr><tr><td><p>DAC Policy Audit Log</p></td><td><p>11.3.0</p></td><td><p>JSON</p></td></tr><tr><td><p>Server Access History</p></td><td><p></p></td><td><p>JSON</p></td></tr><tr><td><p>Command Audit</p></td><td><p></p></td><td><p>JSON</p></td></tr><tr><td><p>Session Logs</p></td><td><p></p></td><td><p>JSON</p></td></tr><tr><td><p>Server Access Control Logs</p></td><td><p></p></td><td><p>JSON</p></td></tr><tr><td><p>Server Role History</p></td><td><p></p></td><td><p>JSON</p></td></tr><tr><td><p>Server Account Lock History</p></td><td><p></p></td><td><p>JSON</p></td></tr><tr><td><p>Request Audit</p></td><td><p></p></td><td><p>JSON</p></td></tr><tr><td><p>Kubernetes Role History</p></td><td><p></p></td><td><p>JSON</p></td></tr><tr><td><p>Web App Access History</p></td><td><p>11.0.0</p></td><td><p>CSV</p></td></tr><tr><td><p>Web App Role History</p></td><td><p>11.0.0</p></td><td><p>CSV</p></td></tr><tr><td><p>Web App JIT Access Control Log</p></td><td><p>11.0.0</p></td><td><p>CSV</p></td></tr><tr><td><p>Web App Event Audit</p></td><td><p>11.0.0</p></td><td><p>CSV</p></td></tr></tbody></table><h2>Audit Log Export 목록 조회하기</h2><ac:image ac:align="center" ac:alt="image-20240714-063656.png" ac:custom-width="true" ac:layout="center" ac:original-height="864" ac:original-width="1566" ac:width="760"><ri:attachment ri:filename="image-20240714-063656.png" ri:version-at-save="1"></ri:attachment><ac:caption><p>Administrator &gt; Audit &gt; General &gt; Audit Log Export</p></ac:caption><ac:adf-mark color="#091e4224" key="border" size="1"></ac:adf-mark></ac:image><ol start="1"><li><p>Administrator &gt; Audit &gt; General &gt; Audit Log Export 메뉴로 이동합니다.</p></li><li><p>현재까지 생성된 Audit Log Export 태스크 목록을 확인할 수 있습니다.</p></li><li><p>Status 에서는 태스크의 진행 상태를 확인할 수 있습니다.</p><ul><li><p><strong>Processing</strong> : 감사 로그 추출이 진행 중입니다.</p></li><li><p><strong>Completed</strong> : 감사 로그 추출이 완료되었으며, 파일 다운로드가 가능합니다. (추출 완료 후 30일이 경과하였다면, 파일이 만료되어 다운로드가 불가능합니다.)</p></li><li><p><strong>Failed</strong> : 감사 로그 추출이 실패하였습니다. QueryPie Customer Support 를 통해 문의 바랍니다.</p></li></ul></li></ol><h2>로그 추출 작업 생성하기</h2><p>감사 로그 추출 및 다운로드는 크게 다음과 같은 단계로 진행됩니다. (1) 관련 메뉴 진입 → (2) 로그 추출 작업 생성 → (3) 로그 추출 완료까지 대기 → (4) 추출 완료 시 파일 다운로드</p><p>감사 로그 추출을 시작하기 위해서는 ‘Audit &gt; General &gt; Audit Log Export’ 메뉴 접근 후, 우측 상단의 <code>Create Task</code> 버튼을 클릭해야 합니다. 해당 버튼 클릭 시 아래와 같은 화면이 나타납니다. </p><ac:image ac:align="center" ac:alt="스크린샷 2025-01-16 오후 1.18.05.png" ac:custom-width="true" ac:layout="center" ac:original-height="1005" ac:original-width="1494" ac:width="612"><ri:attachment ri:filename="스크린샷 2025-01-16 오후 1.18.05.png" ri:version-at-save="1"></ri:attachment><ac:caption><p>Administrator &gt; Audit &gt; General &gt; Audit Log Export &gt; Create New Task</p></ac:caption><ac:adf-mark color="#091e4224" key="border" size="1"></ac:adf-mark></ac:image><ol start="1"><li><p><strong>Task Name </strong>: 로그 추출 작업의 이름을 입력합니다.</p></li><li><p><strong>Log Type </strong>: 추출 대상 로그의 종류를 선택합니다. </p><ol start="1"><li><p>Query Audit 등 추출하기 원하는 로그 타입을 선택합니다.</p></li><li><p>로그 종류 선택 후 <span style="color: rgb(76,154,255);">See Log Template and Description</span>을 클릭하면 각 로그의 key 등 상세 정보를 조회할 수 있습니다.</p></li></ol></li><li><p><strong>Download File Format </strong>: 로그 출력 파일 형식을 지정합니다. (9.17.0 기준, 각 로그마다 다운로드 가능한 형식이 단일로 제한됩니다. 상단의 <strong>‘추출 지원 로그 종류’</strong>을 참고해주시기 바랍니다.) </p></li><li><p><strong>For Text Exceeding 32,000 Characters</strong> : CSV 파일의 경우 32,000자를 초과하는 글자를 잘라낼지 여부를 선택할 수 있습니다.</p><ol start="1"><li><p>Trim Overflowing Text - 32,000자를 초과하는 글자를 잘라냅니다. Excel로 파일을 직접 열어야 하는 경우에 셀당 최대 글자수 초과로 표가 깨지는 현상을 방지합니다.</p></li><li><p>No Action - 32,000자를 초과하는 글자를 그대로 포함시킵니다.</p></li></ol></li><li><p><strong>From</strong> : 추출 시작 날짜를 지정합니다.</p></li><li><p><strong>To </strong>: 추출 대상 마지막 날짜를 지정합니다. 11.2.0부터 당일 날짜를 선택할 수 있도록 개선되었습니다. </p></li><li><p><strong>Filter Expression</strong> : 필터 표현식을 지정합니다. </p><ol start="1"><li><p>조건 입력 방법 및 예시는 하단의 ‘<strong>필터 표현식</strong>’을 참고해주시기 바랍니다.</p></li></ol></li><li><p><strong>Generate Preview </strong>: 미리보기를 생성합니다. </p><ol start="1"><li><p>미리보기는 필수 단계입니다.</p></li><li><p>미리보기 결과를 확인해야 다음 단계인 ‘Create’가 가능합니다.</p></li></ol></li><li><p><code>Create</code> 버튼 : 로그 추출 작업을 생성합니다. </p></li></ol><ac:structured-macro ac:macro-id="f453d3e9-c88d-4457-a68f-cb81ce0c1b6b" ac:name="info" ac:schema-version="1"><ac:rich-text-body><p><strong>유의 사항</strong></p><p>당일 날짜를 선택하여 로그를 추출하는 경우, 실시간으로 데이터가 쌓이기 때문에 Preview 시점의 결과와 실제 Create를 통해 생성된 파일의 내용이 다를 수 있습니다.</p></ac:rich-text-body></ac:structured-macro><ac:adf-extension><ac:adf-node type="panel"><ac:adf-attribute key="panel-type">note</ac:adf-attribute><ac:adf-content><p><strong>필터 표현식</strong></p><p>(1) 필터 표현식을 사용하기 위해 '<span style="color: rgb(76,154,255);">See Log Template and Description</span>'을 통해 로그별 key와 각각의 type 및 포함하는 value를 참고해주시기 바랍니다.<br/></p><p>(2) 사용 가능한 필터 표현식은 데이터의 종류에 따라 아래와 같이 나뉩니다.  </p><p>- Number Type</p><p>지원하는 표현식 : <code>&gt;</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>==</code>, <code>!=</code><br/>예 : <code>x &gt; `10`</code>, <code>x == `10`</code></p><p>- String Type</p><p>지원하는 표현식 :  <code>== (equals)</code>, <code>!= (not equals)</code>, <code>contains</code><br/>예 : <code>x == 'abc'</code>, <code>x != 'abc'</code>, <code>contains(x, 'ab')</code></p><p>- Boolean Type </p><p>지원하는 표현식 : <code>== (equals)</code>, <code>!= (not equals)</code>, <code>&amp;&amp; (and)</code>, <code>|| (or)</code><br/>예 : <code>x == `true`</code>,<code> x &amp;&amp; y</code>, <code>(x &gt; `0`) &amp;&amp; (y == `0`)</code></p><p>- Array Type</p><p>예 : <code>x[? @ == 'value']</code>, <code>list[? @ &gt; `10`]</code></p><p></p><p>(3) 여러 조건을 함께 사용하기 위해 아래의 문자를 활용할 수 있습니다.</p><p>- AND 조건 : <code>&amp;&amp;</code> 연산자를 활용합니다.</p><p>- OR 조건 : <code>||</code> 연산자를 활용합니다.</p><p>- 복합 조건 : 함께 처리해야 하는 조건은 괄호(<code>( )</code>)로 묶어서 활용합니다.</p><p></p><p>(4) 예시</p><p>- Query Audit 중 쿼리 실행 로그만 추출하려는 경우 필요한 표현식 : <code>actionType == 'SQL_EXECUTION'</code></p><p>- Query Audit 중 웹에디터에 수행한 쿼리 실행 로그만 추출하려는 경우 필요한 표현식 : <code>actionType == 'SQL_EXECUTION' &amp;&amp; executedFrom == 'WEB_EDITOR'</code></p><p>- DB Access History 중 특정 데이터베이스 2종류에 대해서만 추출하려는 경우 필요한 표현식 : <code>connectionName == 'database1' || connectionName == 'database2'</code></p><p>- DB Access History 중 특정 데이터베이스 2종류이면서 Replication Type이 SINGLE인 경우에 대해서만 추출하려는 경우 필요한 표현식 : <code>(connectionName == 'database1' || connectionName == 'database2') &amp;&amp; replicationType == 'SINGLE'</code></p></ac:adf-content></ac:adf-node><ac:adf-fallback><div class="panel conf-macro output-block" style="background-color: rgb(234,230,255);border-color: rgb(153,141,217);border-width: 1.0px;"><div class="panelContent" style="background-color: rgb(234,230,255);">
<p><strong>필터 표현식</strong></p><p>(1) 필터 표현식을 사용하시기 위해 '<span style="color: rgb(76,154,255);">See Log Template and Description</span>'을 통해 로그별 key와 각각의 type 및 포함하는 value를 참고해주시기 바랍니다.<br/></p><p>(2) 사용 가능한 필터 표현식은 데이터의 종류에 따라 아래와 같이 나뉩니다.  </p><p>- Number Type</p><p>지원하는 표현식 : <code>&gt;</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>==</code>, <code>!=</code><br/>예 : <code>x &gt; `10`</code>, <code>x == `10`</code></p><p>- String Type</p><p>지원하는 표현식 :  <code>== (equals)</code>, <code>!= (not equals)</code>, <code>contains</code><br/>예 : <code>x == 'abc'</code>, <code>x != 'abc'</code>, <code>contains(x, 'ab')</code></p><p>- Boolean Type </p><p>지원하는 표현식 : <code>== (equals)</code>, <code>!= (not equals)</code>, <code>&amp;&amp; (and)</code>, <code>|| (or)</code><br/>예 : <code>x == `true`</code>,<code> x &amp;&amp; y</code>, <code>(x &gt; `0`) &amp;&amp; (y == `0`)</code></p><p>- Array Type</p><p>예 : <code>x[? @ == 'value']</code>, <code>list[? @ &gt; `10`]</code></p><p> </p><p>(3) 여러 조건을 함께 사용하기 위해 아래의 문자를 활용할 수 있습니다.</p><p>- AND 조건 : <code>&amp;&amp;</code> 연산자를 활용합니다.</p><p>- OR 조건 : <code>||</code> 연산자를 활용합니다.</p><p>- 복합 조건 : 함께 처리해야하는 조건은 괄호(<code>( )</code>)로 묶어서 활용합니다.</p><p> </p><p>(4) 예시</p><p>- Query Audit 중 쿼리 실행 로그만 추출하려는 경우 필요한 표현식 : <code>actionType == 'SQL_EXECUTION'</code></p><p>- Query Audit 중 웹에디터에 수행한 쿼리 실행 로그만 추출하려는 경우 필요한 표현식 : <code>actionType == 'SQL_EXECUTION' &amp;&amp; executedFrom == 'WEB_EDITOR'</code></p><p>- DB Access History 중 특정 데이터베이스 2종류 대해서만 추출하려는 경우 필요한 표현식 : <code>connectionName == 'database1' || connectionName == 'database2'</code></p><p>- DB Access History 중 특정 데이터베이스 2종류이면서 Replication Type이 SINGLE인 경우에 대해서만 추출하려는 경우 필요한 표현식 : <code>(connectionName == 'database1' || connectionName == 'database2') &amp;&amp; replicationType == 'SINGLE'</code></p>
</div></div></ac:adf-fallback></ac:adf-extension><p></p><ac:adf-extension><ac:adf-node type="panel"><ac:adf-attribute key="panel-type">note</ac:adf-attribute><ac:adf-content><p><strong>Query Audit의 내보내기 파일의 Privilege Type 명시 기준</strong></p><p>내보내기 파일의 ‘Privilege Type’ 컬럼에는 실행 시점에는 어느 권한이 필요했는지가 기록됩니다. 아래와 같이 작동합니다. </p><ol start="1"><li><p>기본 권한으로 실행되는 명령어(SET, SHOW 등)는 해당 컬럼의 값이 공백입니다.</p></li><li><p>INSERT 등 권한에 따라 수행된 로그에는 SQL Type이 명시됩니다. </p></li><li><p>Redis의 경우에는 커맨드명이 명시됩니다.</p></li></ol></ac:adf-content></ac:adf-node><ac:adf-fallback><div class="panel conf-macro output-block" style="background-color: rgb(234,230,255);border-color: rgb(153,141,217);border-width: 1.0px;"><div class="panelContent" style="background-color: rgb(234,230,255);">
<p><strong>Query Audit의 내보내기 파일의 Privilege Type 명시 기준</strong></p><p>내보내기 파일의 ‘Privilege Type’ 컬럼에는 실행시점에는 어느 권한이 필요했는지가 기록됩니다. 아래와 같이 작동합니다. </p><ol start="1"><li><p>기본 권한으로 실행되는 명령어(SET, SHOW 등)는 해당 컬럼의 값이 공백입니다.</p></li><li><p>INSERT 등 권한에 따라 수행된 로그에는 SQL Type이 명시됩니다. </p></li><li><p>Redis의 경우에는 커맨드명이 명시됩니다.</p></li></ol>
</div></div></ac:adf-fallback></ac:adf-extension><p></p><h2>추출 작업 완료 시 파일 내려받기</h2><p>별도의 필터링 조건이 없는 단기간 조회의 경우에는 로그 추출이 몇 분 이내에 완료됩니다. 장기간에 걸친 로그이거나 필터링 조건의 복잡도가 높은 경우 등에서는 로그 추출까지 다소 시간이 소요될 수 있습니다.</p><p>추출 작업이 완료된 이후에는 두 가지 방법으로 로그 파일을 내려받을 수 있습니다. </p><ol start="1"><li><p>목록 페이지에서 다운로드: 목록 페이지에서 Download 버튼을 클릭합니다.</p></li><li><p>상세 페이지에서 다운로드: 목록 페이지에서 태스크를 클릭하여 상세 페이지로 진입, 우측 상단 Download 버튼을 클릭합니다.</p></li></ol><ac:adf-extension><ac:adf-node type="panel"><ac:adf-attribute key="panel-type">note</ac:adf-attribute><ac:adf-content><p><strong>다운로드 파일에 암호 포함하기</strong></p><p>다운로드 대상 파일은 ‘*.csv 또는 *.json 파일을 압축한 *.zip 파일’입니다. </p><p>해당 압축 파일에 대한 암호를 지정하기 위해서는 ‘General Setting &gt; Security’ 메뉴에서 <code>Export a file with Encryption</code> 옵션을 ‘Required’로 지정해야 합니다.  </p></ac:adf-content></ac:adf-node><ac:adf-fallback><div class="panel conf-macro output-block" style="background-color: rgb(234,230,255);border-color: rgb(153,141,217);border-width: 1.0px;"><div class="panelContent" style="background-color: rgb(234,230,255);">
<p><strong>다운로드 파일에 암호 포함하기</strong></p><p>다운로드 대상 파일은 ‘*.csv 또는 *.json 파일을 압축한 *.zip 파일’입니다. </p><p>해당 압축 파일에 대한 암호를 지정하기 위해서는 ‘General Setting &gt; Security’ 메뉴에서 <code>Export a file with Encryption</code> 옵션을 ‘Required’로 지정해야 합니다.  </p>
</div></div></ac:adf-fallback></ac:adf-extension><p></p><h2>로그 추출 파일 보관 기간 정책 안내</h2><p>추출이 완료된 로그 파일은 작업 생성일로부터 30일간 보관되며, 해당 기간 이내에는 횟수 제한 없이 내려받기가 가능합니다. 하지만 30일이 경과하면 파일이 만료됩니다. 만료된 로그 파일이 필요해진 경우, 로그 추출 태스크를 다시 생성해주시기 바랍니다.</p>