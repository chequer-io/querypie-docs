---
title: 'Integrating with Okta'
confluenceUrl: 'https://querypie.atlassian.net/wiki/spaces/QM/pages/544376100/Okta'
---

import { Callout } from 'nextra/components'

# Integrating with Okta

### Overview

QueryPie supports integration with Okta.
You can synchronize users and groups from Okta to grant access and apply policies, enabling a simplified user experience while operating with strict security controls.
Integrating QueryPie with Okta enhances security, operational efficiency, and user experience across your database and system management ecosystem.

<Callout type="info">
If you also plan to implement SCIM provisioning integration, please follow the steps in [Okta] Provisioning Integration Guide (../provisioning/okta-provisioning-integration-guide) instead. Using the outbound user synchronization via the Okta API at the same time may affect synchronization; proceed with caution.
</Callout>


### Add QueryPie as an application in Okta

<figure data-layout="center" data-align="center">
<img src="/administrator-manual/general/user-management/authentication/integrating-with-okta/image-20240723-064242.png" alt="Okta Admin &gt; Applications &gt; Applications &gt; Browse App Catalog &gt; Search QueryPie" width="760" />
<figcaption>
Okta Admin &gt; Applications &gt; Applications &gt; Browse App Catalog &gt; Search QueryPie
</figcaption>
</figure>

1. Sign in to the [Okta service](https://login.okta.com/) with an admin account.
2. Click your profile in the upper-right and go to Your Org.
3. In the left panel of the Okta Admin Console, navigate to Applications &gt; Applications.
4. Click the `Browse App Catalog` button and search for QueryPie.
5. On the QueryPie application page, click the `Add Integration` button.
6. Confirm that Application Label is set to QueryPie, then click the `Done` button to add the application.


### Profile settings for Okta account integration

<figure data-layout="center" data-align="center">
<img src="/administrator-manual/general/user-management/authentication/integrating-with-okta/image-20240723-064424.png" alt="Okta Admin &gt; Directory &gt; Profile Editor &gt; QueryPie User &gt; Add Attribute" width="760" />
<figcaption>
Okta Admin &gt; Directory &gt; Profile Editor &gt; QueryPie User &gt; Add Attribute
</figcaption>
</figure>

1. In the left panel of the Okta Admin Console, go to Directory &gt; Profile Editor.
2. From the Profile list, click 'QueryPie User'.
3. In the Attributes section, click the `Add Attribute` button.
4. In the Add Attribute screen, enter the following four items in order and save:
    1. Display name: firstName / Variable name: firstName, then click `Save and Add Another`
    2. Display name: lastName / Variable name: lastName, then click `Save and Add Another`
    3. Display name: email / Variable name: email, then click `Save and Add Another`
    4. Display name: loginId / Variable name: loginId, then click `Save`

<figure data-layout="center" data-align="center">
<img src="/administrator-manual/general/user-management/authentication/integrating-with-okta/image-20240723-064721.png" alt="Okta Admin &gt; Directory &gt; Profile Editor &gt; QueryPie User &gt; Mappings" width="760" />
<figcaption>
Okta Admin &gt; Directory &gt; Profile Editor &gt; QueryPie User &gt; Mappings
</figcaption>
</figure>

1. After confirming the four attributes have been added, click the `Mappings` button.
2. Map Okta User Profile attributes to QueryPie User Profile attributes as follows:
    1. user.firstName ↔︎ firstName
    2. user.lastName ↔︎ lastName
    3. user.email ↔︎ email
    4. user.email ↔︎ loginId (Use Okta's email as QueryPie's login ID.)
3. Click the `Save Mappings` button to save.


### Assign users to the QueryPie application added in Okta

<figure data-layout="center" data-align="center">
<img src="/administrator-manual/general/user-management/authentication/integrating-with-okta/image-20240723-065134.png" alt="Okta Admin &gt; Applications &gt; Applications &gt; QueryPie App" width="760" />
<figcaption>
Okta Admin &gt; Applications &gt; Applications &gt; QueryPie App
</figcaption>
</figure>

1. In the left panel of the Okta Admin Console, navigate to Applications &gt; Applications.
2. From the list, click the QueryPie application.
3. Go to the Assignments tab, click the `Assign` button, and choose `Assign to People` or `Assign to Group`.
4. Assign users or groups who should have access to QueryPie via Okta accounts, then click the Done button.
    1. When assigning People: review user info and click `Save and Go Back`.
    2. When assigning Groups: leave the loginId field blank and click the `Save and Go Back` button.
5. You can now confirm that the users or groups are assigned to the QueryPie application.


### Configure integration information for the QueryPie application in Okta

<figure data-layout="center" data-align="center">
<img src="/administrator-manual/general/user-management/authentication/integrating-with-okta/image-20240723-065346.png" alt="Okta Admin &gt; Applications &gt; Applications &gt; QueryPie App" width="760" />
<figcaption>
Okta Admin &gt; Applications &gt; Applications &gt; QueryPie App
</figcaption>
</figure>

1. On the QueryPie application page in Okta, navigate to the Sign On tab.
2. Click the `Edit` button in the Settings area, enter the domain where QueryPie is installed into the Base URL field, and save.
3. Open the URL shown in Metadata URL in a separate tab and copy the XML displayed there.


### Issue a minimal-privilege Okta API token

To synchronize users, groups, and group memberships between QueryPie and Okta, you need an Okta Admin API token.
Typically, you can generate an API token using a Super Administrator or Read-Only Administrator account as follows:

1. In the left panel of the Okta Admin Console, go to Security &gt; API.
2. In the API menu, go to the Tokens tab.
3. Click the Create Token button to generate an authentication token.

However, to enhance security by minimizing permissions for the Okta API token, we recommend creating a token with the following roles and steps:

<figure data-layout="center" data-align="center">
<img src="/administrator-manual/general/user-management/authentication/integrating-with-okta/image-20240110-042233.png" alt="Okta Admin Console &gt; Security &gt; Administrators &gt; Roles &gt; Create new role" width="762" />
<figcaption>
Okta Admin Console &gt; Security &gt; Administrators &gt; Roles &gt; Create new role
</figcaption>
</figure>

1. In the left panel of the Okta Admin Console, go to Directory &gt; People and click Add Person to create a dedicated system integration account.
    * If you already have an account for QueryPie integration, skip this step.
2. In the left panel of the Okta Admin Console, go to Security &gt; Administrators and navigate to the Roles tab.
3. Select Create new role.
4. Define Role name (e.g., MinimumAdminRole) and Role description, and in Select Permissions, check only the following:
    1. **User**
        * View users and their details
    2. **Group**
        * View groups and their details
    3. **Application**
        * View application and their details
5. Click Save role to save the custom role.
6. Go to the Resources tab.
7. Select Create new resource set.
    * If you already have a resource set for scoping, skip to step 10.
8. Define Name (e.g., MinimumResources) and Description, and specify the following scopes:
    1. User: All QueryPie users
    2. Group: All QueryPie user groups
    3. Application: Limit to the QueryPie app
9. Click Create to finish.
10. Go to the Admins tab and assign the following permissions to the integration account:
    1. Role: MinimumAdminRole | Resource: MinimumResources
    2. Role: Read-Only Administrator
        * Temporary assignment to access the API token creation menu
11. Sign in to the Okta Admin Console with the integration account.
12. Go to Security &gt; API menu and navigate to the Tokens tab.
13. Click the Create Token button to generate an authentication token and store it.
14. Then sign back in with the original admin account you were working with and edit the integration account under Security &gt; Administrators &gt; Admins tab to revoke the Read-Only Administrator permission.


### Configure Okta integration and synchronization in QueryPie

<figure data-layout="center" data-align="center">
<img src="/administrator-manual/general/user-management/authentication/integrating-with-okta/image-20241103-071714.png" alt="Administrator &gt; General &gt; User Management &gt; Authentication" width="760" />
<figcaption>
Administrator &gt; General &gt; User Management &gt; Authentication
</figcaption>
</figure>

1. In QueryPie, go to Administrator &gt; General &gt; User Management &gt; Authentication.
2. Select Okta as the Authentication Type.
3. Paste the copied XML into Identity Provider Metadata.
4. To enable automatic synchronization, check "Use Synchronization with the Authentication System".
    1. API URL: Click your profile in the top-right of the Okta Admin Console to find the URL in the format `{domain}.okta.com`.
    2. API Token: Enter the Okta Admin API token.
    3. Application ID: Enter if you use two or more QueryPie apps in Okta.
5. To use automatic synchronization, set Scheduling in Replication Frequency.
6. Click the `Dry Run` button to verify that the integration information has been entered correctly.
7. Save with `Save Changes`.
8. Click the `Synchronize` button to synchronize users from Okta.


<Callout type="info">
**How to find the Application ID**
If you use two or more QueryPie applications, go to Okta Admin &gt; Applications and open the details page of the QueryPie app. You can find the Application ID in the URL at the top, as shown in the screenshot above.
</Callout>

<figure data-layout="center" data-align="center">
<img src="/administrator-manual/general/user-management/authentication/integrating-with-okta/Authentication-Okta-02.png" alt="Okta Admin &gt; Applications &gt; QueryPie App URL at the top" width="760" />
<figcaption>
Okta Admin &gt; Applications &gt; QueryPie App URL at the top
</figcaption>
</figure>


### Log in to QueryPie using Okta

1. In General Settings &gt; Users or Groups menu, you can verify the synchronized users and groups.
2. You can now log in to QueryPie with your Okta account by clicking the `Login with Okta` button on the sign-in page.

<figure data-layout="center" data-align="center">
<img src="/administrator-manual/general/user-management/authentication/integrating-with-okta/image-20240723-070449.png" alt="image-20240723-070449.png" width="760" />
</figure>

<Callout type="info">
With this integration method, users and groups are synchronized one-way from Okta to QueryPie.
If you also plan to implement SCIM provisioning integration, please follow the steps in [Okta] Provisioning Integration Guide (../provisioning/okta-provisioning-integration-guide).
</Callout>
