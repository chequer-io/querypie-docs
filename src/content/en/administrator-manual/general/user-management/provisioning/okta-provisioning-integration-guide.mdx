---
title: '[Okta] Provisioning Integration Guide'
---

import { Callout } from 'nextra/components'

# [Okta] Provisioning Integration Guide

<Callout type="info">
This guide explains how to implement SCIM integration between QueryPie and Okta using Okta's App Integration Wizard (AIW).
Since QueryPie's SCIM functionality is built based on RFC 7643 to comply with the SCIM 2.0 basic specification, when integrating with other Identity Providers, please follow this guide to collect the necessary information from QueryPie and proceed with the integration.
</Callout>

### Prerequisites

* You need to subscribe to the **Lifecycle Management (LCM)** license for the Okta IAM service.
* You need permissions to access the Okta Admin Console to create apps and assign users/groups to apps.
    * **Minimum required permissions**
        * User
            * Edit users' application assignments
        * Group
            * Edit groups' application assignments
        * Application
            * Manage applications
* Refer to the [https://help.okta.com/en-us/content/topics/security/ip-address-allow-listing.htm](https://help.okta.com/en-us/content/topics/security/ip-address-allow-listing.htm) page for the [Okta IP range allowlist](https://s3.amazonaws.com/okta-ip-ranges/ip_ranges.json) to identify the IP ranges for your tenant and allow inbound traffic exceptions in advance.
* QueryPie must be installed with a license.
* You need an account with Owner/Application Admin Role permissions in QueryPie.
* You must complete the [Activating Provisioning](activating-provisioning) step first.


<Callout type="info">
If you plan to configure outbound user synchronization using the Okta API, please follow the procedures in [Integrating with Okta](../authentication/integrating-with-okta) instead. Please note that enabling it simultaneously with SCIM may affect user synchronization.
</Callout>

### Integration Steps

Once all the prerequisites above are completed, perform the SCIM integration in the following order.
---

#### Create an Okta custom SCIM app

<figure data-layout="center" data-align="center">
![Okta Admin Console &gt; Applications &gt; Applications &gt; Create App Integration &gt; SAML 2.0 &gt; Configure SAML](/administrator-manual/general/user-management/provisioning/okta-provisioning-integration-guide/image-20240723-050205.png)
<figcaption>
Okta Admin Console &gt; Applications &gt; Applications &gt; Create App Integration &gt; SAML 2.0 &gt; Configure SAML
</figcaption>
</figure>

1. Access the [Okta service](https://login.okta.com/) and sign in with an admin account.
2. Click the `Admin` button in the top right to access the Admin Console.
3. In the left panel of the Okta admin page, go to Applications &gt; Applications.
4. Click the `Create App Integration` button.
5. For custom SCIM integration, select **SAML 2.0** as the Sign-in method and click the `Next` button.
6. In the General Settings step, define the values in General Settings appropriately and click the `Next` button at the bottom.
    1. **App name**: Enter an identifiable application name.
    2. **App logo**: Upload a logo that users can identify.
7. In the Configure SAML step, define the values in SAML Settings appropriately and click the `Next` button at the bottom.
    1. **Single sign-on URL**: https://`{{querypie.domain}}`/saml/sp/acs 
    2. **Audience URI (SP Entity ID)**: https://`{{querypie.domain}}`/saml/sp/metadata 
    3. **Attribute Statements (optional)**: Enter the required QueryPie URL attributes as follows:
        1. Name: **firstName** <br/>Name format: Unspecified<br/>Value: **user.firstName**
        2. Name: **lastName** <br/>Name format: Unspecified<br/>Value: **user.lastName**
        3. Name: **email** <br/>Name format: Unspecified<br/>Value: **user.email**
        4. Name: **loginId** <br/>Name format: Unspecified<br/>Value: **user.login**
8. In the Feedback step, select `I'm an Okta customer adding an internal app` and click the `Finish` button at the bottom.
9. After the Application is created, go to the General tab at the top and click the `Edit` button on the right of the **App Settings** menu.
10. Select **SCIM** for the Provisioning field and click the `Save` button.
11. Complete SSO integration by following [Integrating with Okta | Setting QueryPie Application Integration Information in Okta](../authentication/integrating-with-okta#okta%ec%97%90%ec%84%9c-querypie-%ec%95%a0%ed%94%8c%eb%a6%ac%ec%bc%80%ec%9d%b4%ec%85%98-%ec%97%b0%eb%8f%99-%ec%a0%95%eb%b3%b4-%ec%84%a4%ec%a0%95) and [Integrating with Okta | Configuring Okta Integration and Synchronization in QueryPie](../authentication/integrating-with-okta#querypie%ec%97%90%ec%84%9c-okta-%ec%97%b0%eb%8f%99-%eb%b0%8f-%eb%8f%99%ea%b8%b0%ed%99%94-%ec%84%a4%ec%a0%95), then proceed with the following steps.


---

#### Okta-QueryPie Provisioning integration

<figure data-layout="center" data-align="center">
![Okta Admin Console &gt; Applications &gt; Applications &gt; Custom SCIM App &gt; Provisioning &gt; Integration](/administrator-manual/general/user-management/provisioning/okta-provisioning-integration-guide/image-20240723-054522.png)
<figcaption>
Okta Admin Console &gt; Applications &gt; Applications &gt; Custom SCIM App &gt; Provisioning &gt; Integration
</figcaption>
</figure>

<Callout type="info">
You must complete the [Activating Provisioning](activating-provisioning) step first.
</Callout>

1. Go to the Provisioning tab of the SCIM App created in Okta.
2. Click the `Edit` button on the right of SCIM Connection and fill in the following values:
    1. SCIM connector base URL: Insert the SCIM Endpoint value retrieved from QueryPie.
    2. Unique identifier field for users: "**userName**"
    3. Supported provisioning action: Select all five of the following items:
        * Import New Users and Profile Updates
        * Push New Users
        * Push Profile Updates
        * Push Groups
        * Import Groups
    4. Authentication Mode: "**HTTP Header**"
    5. HTTP Header &gt; Authorization: Insert the SCIM-specific access token value generated in QueryPie.
3. Click the Test Connector Configuration button to test the connection.
4. When a popup appears with the message "*Connector configured successfully*", click the `Close` button.
  <figure data-layout="center" data-align="center">
  ![image-20240430-025059.png](/administrator-manual/general/user-management/provisioning/okta-provisioning-integration-guide/image-20240430-025059.png)
  </figure>
5. Click the `Save` button at the bottom to save the connection settings.


---

#### Enable and verify SCIM API

<figure data-layout="center" data-align="center">
![Okta Admin Console &gt; Applications &gt; Applications &gt; Custom SCIM App &gt; Provisioning &gt; To App](/administrator-manual/general/user-management/provisioning/okta-provisioning-integration-guide/image-20240430-034915.png)
<figcaption>
Okta Admin Console &gt; Applications &gt; Applications &gt; Custom SCIM App &gt; Provisioning &gt; To App
</figcaption>
</figure>

1. Go to the To App screen in the Provisioning tab of the SCIM App created in Okta.
2. Click the Edit button on the right of Provisioning to App.
3. Enable the checkboxes for the following settings and click the Save button to save:
    1. **Create Users**: Add users to the app when they are assigned to the app.
    2. **Update User Attributes**: Apply user profile updates to the app when they occur.
    3. **Deactivate Users**: Deactivate users in the app when they are deactivated.
4. Click the `Go to Profile Editor` button under QueryPie SCIM App Attribute Mappings.
5. Click the `Mappings` button under Attributes.
6. Go to the tab labeled "Okta User to `{App name you defined}`" among the two tabs at the top of the popup.
7. Map the items according to your settings and click the `Save Mappings` button at the bottom.
8. Click the `Apply updates now` button at the bottom.

#### How to additionally synchronize some attributes

<Callout type="important">
Some attribute items in the QueryPie Profile, such as staticIp and macAddress, are not imported in the default settings of SCIM Integration.
</Callout>

Some attribute items in the QueryPie profile, such as staticIp and macAddress, are not separately imported during SCIM Integration.
These attributes are:

1. secondEmail 
2. mobilePhone
3. postalAddress (It is added as "formatted" to comply with the SCIM schema, so you can map that item.)
4. staticIp (QueryPie-specific custom attribute)
5. macAddress (QueryPie-specific custom attribute)

If you need to sync these attribute information together, you can add Custom Attributes in IdP such as Okta and map them for synchronization.

##### [Example: Setting Custom Attributes in Okta]

1. Click `Go to Profile Editor` under Provisioning &gt; To App in the SCIM app's Provisioning tab.
  <figure data-layout="center" data-align="center">
  ![image-20240712-082412.png](/administrator-manual/general/user-management/provisioning/okta-provisioning-integration-guide/image-20240712-082412.png)
  </figure>
2. Click the `Add Attribute` button.
  <figure data-layout="center" data-align="center">
  ![image-20240712-082549.png](/administrator-manual/general/user-management/provisioning/okta-provisioning-integration-guide/image-20240712-082549.png)
  </figure>
3. Register a new attribute needed for synchronization.
  <figure data-layout="center" data-align="center">
  ![image-20240712-082453.png](/administrator-manual/general/user-management/provisioning/okta-provisioning-integration-guide/image-20240712-082453.png)
  </figure>
    1. Data type: Select string, same as in QueryPie.
    2. Display name: Enter the attribute name to display in Okta.
    3. Variable name & External name: Enter the variable name of the custom attribute to synchronize.
        * You can also check the variable names in the QueryPie user profile (shown in parentheses).
          <figure data-layout="center" data-align="center">
          ![image-20240712-083117.png](/administrator-manual/general/user-management/provisioning/okta-provisioning-integration-guide/image-20240712-083117.png)
          </figure>
    4. External namespace: Enter the following value.<br/>`urn:ietf:params:scim:schemas:extension:querypie:2.0:User`
    5. Then click the `Save` or `Save and Add Another` button to save.
4. Then click the `Mappings` button.
  <figure data-layout="center" data-align="center">
  ![image-20240712-082549.png](/administrator-manual/general/user-management/provisioning/okta-provisioning-integration-guide/image-20240712-082549.png)
  </figure>
    1. Select the second tab (Okta â†’ `{APP}`) at the top of the prompt.
      <figure data-layout="center" data-align="center">
      ![image-20240712-083618.png](/administrator-manual/general/user-management/provisioning/okta-provisioning-integration-guide/image-20240712-083618.png)
      </figure>
    2. Map the newly created Custom Attribute with the appropriate Attribute in IdP at the bottom and click the Save Mappings button to save the settings.
      <figure data-layout="center" data-align="center">
      ![image-20240712-085207.png](/administrator-manual/general/user-management/provisioning/okta-provisioning-integration-guide/image-20240712-085207.png)
      </figure>
5. Then assign users to the app.


---

#### Verify user provisioning

1. Return to the SCIM app and assign users through the options of the `Assign` button in the Assignments tab.
  <figure data-layout="center" data-align="center">
  ![Okta Admin Console &gt; Applications &gt; Applications &gt; Custom SCIM App &gt; Assignments](/administrator-manual/general/user-management/provisioning/okta-provisioning-integration-guide/image-20240430-035937.png)
  <figcaption>
  Okta Admin Console &gt; Applications &gt; Applications &gt; Custom SCIM App &gt; Assignments
  </figcaption>
  </figure>
    1. **Assign to People**: Assign by individual users
    2. **Assign to Groups**: Assign by user group
2. Return to the QueryPie app and go to Administrator &gt; General &gt; User Management &gt; Users to verify that users have been pushed successfully.
  <figure data-layout="center" data-align="center">
  ![Administrator &gt; General &gt; User Management &gt; Users &gt; List Details](/administrator-manual/general/user-management/provisioning/okta-provisioning-integration-guide/image-20240723-040531.png)
  <figcaption>
  Administrator &gt; General &gt; User Management &gt; Users &gt; List Details
  </figcaption>
  </figure>
---

#### Verify group provisioning

<figure data-layout="center" data-align="center">
![Okta Admin Console &gt; Applications &gt; Applications &gt; Custom SCIM App &gt; Push Groups](/administrator-manual/general/user-management/provisioning/okta-provisioning-integration-guide/image-20240430-062231.png)
<figcaption>
Okta Admin Console &gt; Applications &gt; Applications &gt; Custom SCIM App &gt; Push Groups
</figcaption>
</figure>

1. Return to the SCIM app and push groups through the options of the `Push Groups` button in the Push Groups tab.
    1. **Find groups by name**: Search by the group name to push and assign
    2. **Find groups by rule**: Define search rules to assign groups that match the conditions
2. Return to the QueryPie app and go to Administrator &gt; General &gt; User Management &gt; Groups to verify that groups have been pushed successfully.

<Callout type="important">
For groups whose Auth Provider is not QueryPie and were created by being pushed from third-party Identity Providers (IdP) such as Okta, we recommend unlinking and deleting them from the IdP side.
If you delete such groups in this product, the management flow in the IdP may become disrupted, and it may be difficult to push the same deleted group name back into the product.
</Callout>
