---
title: 'Secret Store連携'
---

import { Callout } from 'nextra/components'

# Secret Store連携

### Overview

IntegrationsメニューではSecret Storeの情報を入力し管理します。

Secret Storeを通じて安全にDBおよびサーバー認証情報を管理でき、ユーザーに直接的な認証情報露出なしにDBおよびサーバーに安全に接続できます。
コネクション接続情報保存時認証情報をQueryPie内部に保存するのではなくSecret Storeから取得して認証できるよう設定できます。

実際[Secret Storeの使用](../../company-management/security)可否はSecurityメニューで設定できます。
以下はQueryPieでサポート中のSecret Storeサービスリストです。

* HashiCorp Vault
* Microsoft Active Directory


<Callout type="info">
**Vault連携時事前準備事項:**

1.  **QueryPie連携するVaultサーバー:**
    * Vaultと連携するには該当Vaultサーバーが動作していなければなりません。Vaultサービスが実行され、APIリクエストを処理でき、Vaultで認証処理を実行できなければなりません。
2.  **Vaultに保存されたリソースの認証情報:**
    * Vaultと連携するにはVaultに接続するサービス（例：DB、Serverなど）の認証情報を事前に保存しておく必要があります。連携しようとするサービスに対するアクセス権限と認証情報（例：Username、Password、APIキーなど）をVaultに保存した状態を意味します。
3.  **認証情報呼び出しのための正しいパス（Path）:**
    * Vaultに保存された資格証明を識別するのに使用されるパス（パス）は正確でなければなりません。これはVaultでどの資格証明を取得すべきかを指定するパスを言います。このパスはVaultに保存されたリソースおよび資格証明と接続されます。

* より詳細なVault構成は[Hashicorp Vault Documentation公式ドキュメント](https://developer.hashicorp.com/vault/docs)を参照してください。
</Callout>

<Callout type="important">
実際にQueryPieでSecret Storeに認証情報を保存するには、Vault連携を完了した後SecurityページでSecret Store使用を有効化する必要があります。
詳細内容はSecurity l Secre Store設定ドキュメントを参照してください。
</Callout>


### HashiCorp Vault連携情報照会

<figure data-layout="center" data-align="center">
![Administrator &gt; General &gt; System &gt; Integrations &gt; HashiCorp Vault](/administrator-manual/general/system/integrations/integrating-with-secret-store/screenshot-20240723-094426.png)
<figcaption>
Administrator &gt; General &gt; System &gt; Integrations &gt; HashiCorp Vault
</figcaption>
</figure>

1. Administrator &gt; General &gt; System &gt; Integrations &gt; メニューに進入します。
2. Secret Store下部のHashiCorp Vaultタイルをクリックします。
3. 現在連携中のVaultリストを照会できます。


### HashiCorp Vault連携情報削除

Administrator &gt; General &gt; Securityページ内Secret Store有効化を解除するにはまず連携されているVault情報をすべて削除する必要があります。
以下は連携情報を削除する方法です。

<figure data-layout="center" data-align="center">
![Administrator &gt; General &gt; System &gt; Integrations &gt; HashiCorp Vault &gt; Delete](/administrator-manual/general/system/integrations/integrating-with-secret-store/screenshot-20240723-095912.png)
<figcaption>
Administrator &gt; General &gt; System &gt; Integrations &gt; HashiCorp Vault &gt; Delete
</figcaption>
</figure>

1. テーブルでチェックボックスを選択するとヘッダー領域に`Delete`ボタンが表示されます。ボタンをクリックします。
2. 削除確認モーダルで`OK`ボタンをクリックします。
3. リスト上で、選択したリストアイテムの削除完了を確認します。


### HashiCorp Vault連携情報入力

<figure data-layout="center" data-align="center">
![Administrator &gt; General &gt; System &gt; Integrations &gt; HashiCorp Vault &gt; Connect](/administrator-manual/general/system/integrations/integrating-with-secret-store/Screenshot-2025-05-27-at-11.37.33-AM.png)
<figcaption>
Administrator &gt; General &gt; System &gt; Integrations &gt; HashiCorp Vault &gt; Connect
</figcaption>
</figure>

1. HashiCorp Vaultページで`Connect`ボタンをクリックします。
2.  **Name**  : Secret Storeの名称を入力します。
3.  **Service** : このSecret Storeの接続を使用するサービス（DBまたはServer）を選択します。
    1. Service項目は保存後変更が不可能です。
4. 選択されたSecret Storeタイプにより連携のための認証情報を入力します。
    1.  **Server Address**  : Secret Storeサーバーのアドレスを入力します。
    2.  **Auth Method**  : QueryPieとVaultの認証方式を選択します。
        1.  **Token**  : Vaultで発行されたTokenを利用した認証方式です。
        2.  **AppRole**  : Role IDとSecret ID組み合わせを利用した認証方式です。
            1.  **Role ID**  : AppRole認証時必須で使用される固有識別子です。
            2.  **Secret ID**  : ログイン時に必要な秘密Credentialsです。
    3.  **Secret Engine**  : Hashicorp VaultのSecret Engineタイプを選択します。
        1. 現在バージョン基準Database、K/V、SSH OTP、SSH CAエンジン4つをサポートします。
        2. Secret Engineは保存後変更が不可能です。
        3. 変更したい場合はすべてのコネクションのSecret Store設定を解除した後再設定が必要です。
5.  **Namespace**  : VaultのNamespaceを入力します。
    1. Namespace項目は保存後変更が不可能です。
6. 必要なすべての情報を入力したら、**Verify integration**ボタンをクリックします。
    1. すべての情報が正しく入力されていれば：check_mark: Successメッセージが表示されます。
7. `OK`ボタンをクリックして保存します。


<Callout type="info">
**Active Directory連携時事前準備事項:**
1.  **Active Directoryサーバー** : QueryPieと連携するADサーバーが正常に動作していなければならず、LDAPS（LDAP over SSL）接続をサポートしなければなりません。
2.  **管理者アカウント情報** : ADに接続して他のユーザーアカウントのパスワードを変更できる権限を持つアカウントの情報（ユーザー名、パスワード）が必要です。
3.  **ネットワーク設定** : QueryPieサーバーからADサーバーのLDAPSポート（デフォルト値：636）にアクセス可能でなければなりません。
</Callout>

### Active Directory連携情報照会

<figure data-layout="center" data-align="center">
![Administrator &gt; General &gt; System &gt; Integrations &gt; Microsoft Active Directory](/administrator-manual/general/system/integrations/integrating-with-secret-store/Screenshot-2025-07-22-at-11.32.23-AM.png)
<figcaption>
Administrator &gt; General &gt; System &gt; Integrations &gt; Microsoft Active Directory
</figcaption>
</figure>

1. Administrator &gt; General &gt; System &gt; Integrationsメニューに進入します。
2. Microsoft Active Directory（AD）タイルをクリックします。
3. 現在連携中のAD情報リストを照会できます。


### Active Directory連携情報削除

<figure data-layout="center" data-align="center">
![Screenshot-2025-07-22-at-11.33.43-AM.png](/administrator-manual/general/system/integrations/integrating-with-secret-store/Screenshot-2025-07-22-at-11.33.43-AM.png)
</figure>

1. 削除するAD情報のテーブル項目でチェックボックスを選択するとヘッダー領域に`Delete`ボタンが表示されます。該当ボタンをクリックします。
2. 削除確認モーダルで`OK`ボタンをクリックします。
3. リストで選択した項目が削除されたか確認します。

<Callout type="info">
**Active Directory削除時注意事項**
Active Directory連携情報を削除する前に、該当ADドメインと接続されたすべての個人アカウント（UPN）をまず削除する必要があります。
Admin &gt; Servers&gt; Account Management &gt; Active Directoryタブで関連アカウントをすべて削除した後次の手順を進行してください。
</Callout>


### Active Directory連携情報入力

<figure data-layout="center" data-align="center">
![Screenshot-2025-07-22-at-11.33.26-AM.png](/administrator-manual/general/system/integrations/integrating-with-secret-store/Screenshot-2025-07-22-at-11.33.26-AM.png)
</figure>

1. Active Directoryページで`+ Connect`ボタンをクリックします。
2. 連携に必要な情報を入力します。
    1.  **Name** : 連携情報の名称を入力します。
    2.  **Domain Information** : パスワードを管理するActive Directoryのドメイン名を入力します。
    3.  **Server Address** : Active Directoryサーバーのアドレスを入力します。
    4.  **Auth Type** : 認証方式はLDAPSで固定されています。
    5.  **Port** : LDAPSポート番号を入力します。（デフォルト値：636）
    6.  **Admin Account** : ADに接続する管理者アカウントのユーザー名を入力します。このアカウントは他のユーザーのパスワードを変更できる権限が必要です。
    7.  **Admin Password** : 管理者アカウントのパスワードを入力します。
3. すべての情報を入力したら、`Verify Integration`ボタンをクリックしてADサーバーとの連携を確認します。
4. 連携確認成功メッセージが表示されると`Save`ボタンをクリックして設定を完了します。
