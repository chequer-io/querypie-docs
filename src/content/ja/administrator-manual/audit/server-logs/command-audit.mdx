---
title: 'Command Audit'
---

import { Callout } from 'nextra/components'

# Command Audit

### Overview

QueryPieを通じて接続したサーバーで実行したコマンドを記録します。Windows Serverの場合、マウスクリック、キーボード入力、実行プロセス名を記録します。

### Command Auditの照会

<figure data-layout="center" data-align="center">
![Administrator &gt; Audit &gt; Servers &gt; Command Audit](/administrator-manual/audit/server-logs/command-audit/image-20240728-171227.png)
<figcaption>
Administrator &gt; Audit &gt; Servers &gt; Command Audit
</figcaption>
</figure>

* Administrator &gt; Audit &gt; Servers &gt; Command Auditメニューに移動します。
* 接続日基準でログが降順で照会されます。
* テーブル左上の検索欄を通じて以下の条件で検索が可能です。
    *  **Name**  : ユーザー名
    *  **Server Name**  : 接続サーバー名
    *  **Command**  : 実行したコマンド
    *  **Role**  : 接続Role
* 検索フィールド右側フィルターボタンをクリックしてAND/OR条件で以下のフィルタリングが可能です。
  <figure data-layout="center" data-align="center">
  ![image-20240728-171533.png](/administrator-manual/audit/server-logs/command-audit/image-20240728-171533.png)
  </figure>
    *  **Server OS**  : 接続したサーバーのOS
    *  **Protocol** : 接続使用したProtocol
    *  **Executed From** : 接続方式
        * web : QueryPie Webを通じた接続
        * proxy : AgentまたはSeamless SSH Connectionを通じた接続
    *  **Action Type** : 記録されたイベントタイプ
        * Command : ログに記録されたコマンド
        * File Download : (SFTP) ファイルダウンロード
        * File Upload : (SFTP) ファイルアップロード
        * Process Start : (RDP) プロセス実行
        * Process Stop : (RDP) プロセス終了
        * User Input - MouseClick : (RDP) ユーザーマウスクリック
        * User Input - MouseDoubleClick : (RDP) ユーザーマウスダブルクリック
        * User Input - KeyPress : (RDP) ユーザーキーボード入力
    *  **Executed At**  : コマンド実行時点
    *  **Restricted**  : コマンド遮断の有無

<Callout type="info">
11.3.0でフィルターを使用する際、Action Typeの項目を複数選択できるよう変更されました。
<figure data-layout="center" data-align="center">
![フィルターのAction Typeで複数の項目を選択した例](/administrator-manual/audit/server-logs/command-audit/image-20250930-083734.png)
<figcaption>
フィルターのAction Typeで複数の項目を選択した例
</figcaption>
</figure>
</Callout>

* テーブル右上のリフレッシュボタンを通じてログ一覧を最新化できます。
* テーブルで以下のカラム情報を提供します:
    *  **No**  : イベント識別番号
    *  **Executed At**  : コマンド実行時点
    *  **Name**  : 対象ユーザー名
    *  **Email**  : 対象ユーザーメール
    *  **Role**  : 対象ユーザー接続時使用されたRole名
    *  **Account**  : サーバー接続Account
    *  **Command**  : 実行したコマンド
    *  **Restricted**  : コマンド遮断の有無
        * Not Restricted
        * Restricted
    *  **Restricted Command**  : 遮断されたコマンド
    *  **Server Name**  : 対象サーバー名
    *  **Server OS**  : 接続したサーバーのOS
    *  **Host**  : 接続したサーバーのホスト
    *  **Port**  : 接続時使用されたポート
    *  **Protocol** : 接続使用したProtocol
    *  **Client IP**  : ユーザークライアントIPアドレス
    *  **Client**   **Name**  : ユーザーの接続方式
    *  **Action Type** : 記録されたイベントタイプ
    *  **Message**  : 接続失敗など特異事項に対する記録

### Command Audit詳細内訳の照会

各行をクリックすると詳細情報照会が可能です。


<figure data-layout="center" data-align="center">
![Administrator &gt; Audit &gt; Servers &gt; Command Audit &gt; Command Audit Details](/administrator-manual/audit/server-logs/command-audit/image-20241209-125101.png)
<figcaption>
Administrator &gt; Audit &gt; Servers &gt; Command Audit &gt; Command Audit Details
</figcaption>
</figure>

* 右側ドロワーには以下の情報を露出します:
    *  **Name**  : 対象ユーザー名
    *  **Action Type** : 記録されたイベントタイプ
    *  **Executed At**  : コマンド実行時点
    *  **Executed From** : 接続方式
    *  **Server Access History** : 該当セッションの接続ログ
    *  **Session Log**  : このコマンドを実行したセッションレコーディング照会
    *  **Server Name**  : 対象サーバー名
    *  **Server OS**  : 接続したサーバーのOS
    *  **Host**  : 接続したサーバーのホスト
    *  **Port**  : 接続時使用されたポート
    *  **Account**  : サーバー接続Account
    *  **Protocol** : 接続使用したProtocol
    *  **Client**   **Name**  : ユーザーの接続方式
    *  **Client IP**  : ユーザークライアントIPアドレス
    *  **Restricted**  : コマンド遮断の有無
    *  **Restricted Command**  : 遮断されたコマンド
    *  **Detected Type :** 検出された遮断コマンドの実行方式(Shell ScriptまたはAlias)
    *  **Command**  : ユーザー入力コマンド(RDPの場合プロセス名またはクリック座標など)
    *  **Result**  : コマンド実行結果


<Callout type="important">
Enterキーを複数回連続で押しても、Command Auditには一回のみ記録されます。<br/>実際入力内容はSession Logのレコーディングされた画面で確認できます。
</Callout>
