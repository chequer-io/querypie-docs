---
title: 'Data Access'
confluenceUrl: 'https://querypie.atlassian.net/wiki/spaces/QM/pages/544379937/Data+Access'
---

import { Callout } from 'nextra/components'

# Data Access

### Overview

組織内で個人情報または機密情報のようにアクセス制限が必要なデータは照会時該当データを確認できないようポリシーを設定できます。
Data Accessメニューでポリシーを設定するコネクションを選択してポリシーを生成し、アクセス制限が必要なデータをテーブルまたはカラム基準で規則を登録し管理できます。

### テーブル/カラムアクセス制限ポリシー生成

新しいテーブル/カラムアクセス制限ポリシーをコネクション基準で登録します。

<figure data-layout="center" data-align="center">
<img src="/administrator-manual/databases/policies/data-access/image-20240725-072304.png" alt="Administrator &gt; Databases &gt; Policies &gt; Data Access " width="760" />
<figcaption>
Administrator &gt; Databases &gt; Policies &gt; Data Access 
</figcaption>
</figure>

1. Database設定メニューでPolicies &gt; Data Accessメニューに移動します。
2. 右上の`Create Policy`ボタンをクリックします。
3. ポリシー生成のための以下の情報を入力します。
    1.  **Policy Name**  ：ポリシーを画面で区別できる名前です。
    2.  **Target Connection**  ：ポリシーを適用するコネクションを選択します。1個のポリシー当たり1個のコネクションを接続できます。
4. `Save`ボタンで保存します。

該当ポリシーがData Accessポリシーリストに生成されたことを確認できます。


### テーブル/カラムアクセス制限ポリシーに規則登録

<figure data-layout="center" data-align="center">
<img src="/administrator-manual/databases/policies/data-access/data-access-02.png" alt="Administrator &gt; Databases &gt; Policies &gt; Data Access &gt; Details &gt; Add Rule" width="760" />
<figcaption>
Administrator &gt; Databases &gt; Policies &gt; Data Access &gt; Details &gt; Add Rule
</figcaption>
</figure>

ポリシーを生成した後、実際にポリシーを適用するデータの経路を規則として登録します。

1. Data Accessメニューで生成したポリシーをクリックします。
2. ポリシー詳細情報および規則登録画面が表示され、右側で`Add Rule List`ボタンをクリックします。
3. ポリシーを適用するデータの経路を順番に選択します。
    1.  **Database Name**  ：規則登録のための必須値です。
    2.  **Table Name**  ：規則登録のための必須値です。テーブルのみ選択する場合、該当テーブル照会自体が不可能になるよう制限されます。
    3.  **Column Name**  ：カラム単位でデータアクセスを制限しようとする場合選択します。
4. 該当データ照会が必要なユーザーまたはグループに限ってテーブル/カラムアクセス制限規則を例外処理できます。
    *  **Allowed Users**  ：該当規則を例外処理するユーザーまたはグループを選択します。
5. `Ok`ボタンで保存します。

Rule Listタブで規則が登録されたことを確認できます。
これでユーザーが該当データを照会すると、テーブルにポリシーが適用された場合テーブル自体を照会できず、カラムに規則が適用された場合 *`{RESTRICTED}`* で表示されます。

<figure data-layout="center" data-align="center">
<img src="/administrator-manual/databases/policies/data-access/data-access-03.png" alt="SQL Editor &gt; ポリシーが適用されたデータ照会時 *`{RESTRICTED}`* で表示" />
<figcaption>
SQL Editor &gt; ポリシーが適用されたデータ照会時 *`{RESTRICTED}`* で表示
</figcaption>
</figure>

<Callout type="important">
Database Name選択時「[ENGINE] [30101] Please Check the user credential or IP ACL settings.
Access denied for user 'username'@'host' (using password: YES)」エラーが発生します。
A. この場合、DBアカウント情報設定がされていないか間違った情報で設定されている可能性があります。
Administrator &gt; Databases &gt; Connection Management &gt; DB Connectionsメニューで該当コネクション情報クリック後、**Database Username / Password情報を入力して保存**した後再び試行します。
</Callout>

### アクセス制限ポリシーが適用されたテーブル/カラムに対するアクセスログ確認

<Callout type="info">
10.3.0からData accessポリシーが制限したテーブルおよびカラムに対するアクセスログを確認できます。
</Callout>

<figure data-layout="center" data-align="center">
<img src="/administrator-manual/databases/policies/data-access/image-20250512-040339.png" alt="Logsタブでログ確認" width="736" />
<figcaption>
Logsタブでログ確認
</figcaption>
</figure>

1. ポリシーリストで生成したポリシーの個別項目（行）をクリックして詳細ページに移動します。
2. Logsタブを選択します。
3. Logの内容を確認します。
    1.  **Name** ：QueryPieユーザーのDisplay Nameです。
    2.  **Connection**  ：ポリシーが制御している対象コネクションです。
    3.  **Database Name** ：ポリシーが制御している対象論理DB名です。
    4.  **Table Name**  ：ポリシーが制御している対象テーブル名です。
    5.  **Column Name**  ：ポリシーが制御している対象単一または複数のカラム名です。
    6.  **Rows**  ：クエリが返す行数です。
    7.  **Action At**  ：クエリを実行した時点です。
4. Logタブの行をクリックすると詳細画面で実行されたクエリを確認できます。
  <figure data-layout="center" data-align="center">
  <img src="/administrator-manual/databases/policies/data-access/image-20250512-040436.png" alt="ログの詳細画面でクエリ内容確認" width="736" />
  <figcaption>
  ログの詳細画面でクエリ内容確認
  </figcaption>
  </figure>