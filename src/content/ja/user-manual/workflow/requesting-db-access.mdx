---
title: 'DB Access Request要求'
confluenceUrl: 'https://querypie.atlassian.net/wiki/spaces/QM/pages/544377968/DB+Access+Request'
---

import { Callout } from 'nextra/components'

# DB Access Request要求

### Overview

下記順序に従ってアクセスが必要なDBコネクションに対するPrivilegeを要求できます。
要求後承認が完了すると即座に権限が付与され、QueryPie WebにあるSQL EditorまたはAgentを通じて権限を受けたコネクションに接続できます。


### DB Access Request要求

#### 1. 決裁ルール選択

* Approval Ruleを選択して目的に合う決裁ルールを選択してください。選択したルールに応じて承認対象が変わります。 
* もし管理者が承認者を指定した決裁ルールが選択された場合、自動で承認者が指定され追加および変更が不可能です。
*  **Approval Expiration Date** : 承認期限切れ日を入力します。Maximum Approval Durationを通じて最大値を設定できます。Approval Expiration DateはAccess Expiration Dateを超過できません。超過した場合、上申できません。Maximum Approval Duration &gt; Maximum Access Durationの場合、Maximum Approval Durationの値がMaximum Access Durationの値と同一に適用されます。例) Maximum Approval Durationは14日でMaximum Access Durationは5日の場合、Maximum Approval Durationの値も5日に適用されます。 
    * ただし、Urgent Modeで上申時、上記条件を無視します。

<figure data-layout="center" data-align="center">
<img src="/user-manual/workflow/requesting-db-access/Screenshot-2025-08-26-at-12.21.07-AM.png" alt="Screenshot-2025-08-26-at-12.21.07-AM.png" width="760" />
</figure>

#### 2. 承認者指定

* 決裁ラインで`+`ボタンを押すと段階別承認者を指定できるポップアップウィンドウが表示されます。 
* このポップアップウィンドウで決裁承認条件および承認者を追加後`Save`ボタンを押して決裁ラインを保存します。
* 選択可能な承認条件は以下の通りです。 
    * A single Assignee can complete the approval request : 複数名中一人の承認だけで決裁要求が承認処理されます。
    * All Assignees must approve this request : すべての承認者が承認しなければ決裁要求が承認処理されます。

<figure data-layout="center" data-align="center">
<img src="/user-manual/workflow/requesting-db-access/screenshot-20240724-154729.png" alt="screenshot-20240724-154729.png" width="763" />
</figure>

#### 3. 参照者指定

* 決裁ラインで`+`ボタンを押すと参照者を指定できるポップアップウィンドウが表示されます。 
    * 管理者が参照者指定を許可しない場合はReviewerボックスが表示されません。 
* このポップアップウィンドウで決裁承認条件および承認者を追加します。 
* `Save`ボタンを押してモーダルを閉じ参照者指定を完了します。

<figure data-layout="center" data-align="center">
<img src="/user-manual/workflow/requesting-db-access/screenshot-20240724-171350.png" alt="screenshot-20240724-171350.png" width="760" />
</figure>

#### 4. 事後承認で要求送信

<Callout type="info">
11.3.0から事後承認で要求する場合決裁期限切れ日を指定できないように変更されました。
</Callout>

* 事後承認機能が許可された決裁ルールを選択した場合Urgent Modeスイッチが表示されます。 
* Urgent mode = Onに設定後決裁要求を登録すると即座に権限を付与されたり作業を実行できます。

<figure data-layout="center" data-align="center">
<img src="/user-manual/workflow/requesting-db-access/screenshot-20240523-184245.png" alt="screenshot-20240523-184245.png" width="760" />
</figure>

<Callout type="important">
**Q. Urgent Modeスイッチが見えません。**
A. 管理者がUrgent Modeを許可しない決裁ルールを選択した場合、該当機能が表示されません。
</Callout>

#### 5. 要求情報入力

*  **Title**  : 要求タイトルを入力します。 
*  **Access Expiration Date**  : 要求権限の期限切れ日を入力します。基本値は管理者ページでDAC configurationsのMaximum Access Duration値に従います。 
*  **Reason for Request**  : アクセス権限を要求する理由を入力します。 

<figure data-layout="center" data-align="center">
<img src="/user-manual/workflow/requesting-db-access/Screenshot-2025-08-26-at-12.24.44-AM.png" alt="User &gt; Workflow &gt; Submit Request &gt; DB Access Request &gt; Request Summary" width="729" />
<figcaption>
User &gt; Workflow &gt; Submit Request &gt; DB Access Request &gt; Request Summary
</figcaption>
</figure>

#### 6. 要求するDBコネクション選択および権限指定

* Request Summary領域内テーブルには現在QueryPieに登録されているDBコネクション目録が表示されます。 
    *  **Privilege Type**  : 特定DBコネクションに要求するPrivilege Typeを指定するとその値が表示されます。 
    *  **Current Privilege**  : 該当コネクションの現在権限を表示します。現在アクセス権限がない場合は空です。
    *  **Expiration Date**  : 現在該当コネクションに付与されている権限の期限切れ日を表示します。
* アクセス権限を要求するDBコネクションをチェックボックスで選択後下記二つの方法でPrivilege Typeを選択できます。
<figure data-layout="center" data-align="center">
<img src="/user-manual/workflow/requesting-db-access/screenshot-20240801-191054.png" alt="ドロップダウンを通じてコネクション別に指定" width="362" />
<figcaption>
ドロップダウンを通じてコネクション別に指定
</figcaption>
</figure>
<figure data-layout="center" data-align="center">
<img src="/user-manual/workflow/requesting-db-access/screenshot-20240801-191152.png" alt="チェックボックスおよびApplyボタンを通じた一括適用" width="362" />
<figcaption>
チェックボックスおよびApplyボタンを通じた一括適用
</figcaption>
</figure>
* 選択可能なPrivilege Typeは以下の通りです。 
    *  **Read/Write権限**  : 全体権限です。 
    *  **Read-Only権限**  : SELECTのみ可能な権限です。
    *  **その他権限**  : 管理者が追加で作成した権限で作成した権限がない場合は上記二つの権限のみ表示されます。 
* 決裁ルール指定および要求本文入力が完了したらページ下部の`Submit`ボタンを押して要求を上申します。

### DB Access Request要求（Schema Level）

<Callout type="info">
11.5.0からSchema（Logical DB）単位のアクセス申請が可能です。
以下の内容は共通部分は省略し、異なる部分中心で説明しました。
</Callout>

1. Submit Requestボタンを押し、メニューで「DB Access Request（Schema Level）」を選択します。
  <figure data-layout="center" data-align="center">
  <img src="/user-manual/workflow/requesting-db-access/image-20251218-120432.png" alt="image-20251218-120432.png" width="736" />
  </figure>
2. `Add Item`ボタンを押します。<br/>
  <figure data-layout="center" data-align="center">
  <img src="/user-manual/workflow/requesting-db-access/image-20251218-120721.png" alt="image-20251218-120721.png" width="736" />
  </figure>
3. 左側パネルで接続するコネクションを選択します。
  <figure data-layout="center" data-align="center">
  <img src="/user-manual/workflow/requesting-db-access/image-20251218-121011.png" alt="image-20251218-121011.png" width="736" />
  </figure>
4. コネクションを選択すると右側のprivilege項目に基本的にselect権限が必要なスキーマに自動的にSELECT privilegeが付与されたことが見えます。この項目を削除することもできますが、その場合Web editorまたはproxyでスキーマ構造を照会する時点にエラーが発生する可能性があるため、やむを得ない場合でなければこの項目を削除しません。<br/>`Add Item`ボタンを押します。<br/>
  <figure data-layout="center" data-align="center">
  <img src="/user-manual/workflow/requesting-db-access/image-20251218-121402.png" alt="image-20251218-121402.png" width="736" />
  </figure>
5. 下に対象を追加できる行が追加されます。schema構造があるDBMS（Oracle、Postgresなど）は対象名を入力する時、必ず`{database名}`.`{schema名}`の形式で入力する必要があります。MySQLのようにschema構造がないDBMSは論理DB名のみ入力すれば 됩니다。
  <figure data-layout="center" data-align="center">
  <img src="/user-manual/workflow/requesting-db-access/image-20251218-122027.png" alt="image-20251218-122027.png" width="736" />
  </figure>
    * Oracle例：ORCLDB.TESTUSER
    * PostgreSQL例：testdb.test_schema
    * MySQL例：sakila<br/>
6. privilege割り当てはまずポップアップウィンドウ右側上部のHost Level Privilege項目で希望するprivilege typeを選択します。（スキーマレベルprivilegeはhost level privilegeの範囲内でのみ付与が可能なためです。例えばRead/WriteをHost Level Privilegeで選択した場合、その範囲内でSELECT、INSERTなどを付与できますが、Read-OnlyをHost Level Privilegeで選択した場合、SELECTのみ指定できます。）Host Level privilegeに割り当てが必要なprivilegeがない場合、管理者に該当コネクションに対して特定privilegeがあるprivilege typeを作成してほしいと要求する必要があります。<br/>
  <figure data-layout="center" data-align="center">
  <img src="/user-manual/workflow/requesting-db-access/image-20251218-122450.png" alt="image-20251218-122450.png" width="736" />
  </figure>
7. 下に表示されるHost Level Others、Host Level Functionsは設定を見るだけです。Host LevelのPrivilegeの属性によりSchema Levelもprivilegeが従属するため、上位の情報を確認する用途で使用されます。
  <figure data-layout="center" data-align="center">
  <img src="/user-manual/workflow/requesting-db-access/image-20251218-122702.png" alt="image-20251218-122702.png" width="736" />
  </figure>
8. `OK`ボタンを押し、フォームの残りの部分を入力した後`Submit`ボタンを押して要求を完了します。
