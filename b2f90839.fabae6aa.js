(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{119:function(e,t,a){"use strict";a.r(t),t.default=a.p+"assets/images/public-zone-f8132a366a3a9eae748a5970d7315674.png"},135:function(e,t,a){"use strict";a.r(t),t.default=a.p+"assets/images/privacy-zone-8b14e681bc60edcf02c9d015fe7b8763.png"},136:function(e,t,a){"use strict";a.r(t),t.default=a.p+"assets/images/cluster_1-14b46ddfcd7ed175969e176984f99022.png"},137:function(e,t,a){"use strict";a.r(t),t.default=a.p+"assets/images/cluster_2-067166b5ed88c812e2749794654c51d2.png"},138:function(e,t,a){"use strict";a.r(t),t.default=a.p+"assets/images/cluster_3-eb038839ac06a0ce27c08084fcea2157.png"},139:function(e,t,a){"use strict";a.r(t),t.default=a.p+"assets/images/cluster_4-2f1e5fcdf20e7d15311e22da24664e37.png"},76:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return c})),a.d(t,"metadata",(function(){return b})),a.d(t,"rightToc",(function(){return i})),a.d(t,"default",(function(){return s}));var n=a(2),l=a(6),r=(a(0),a(93)),c={id:"doc1",title:"QueryPie Install Guide",sidebar_label:"QueryPie Install Guide",slug:"/"},b={unversionedId:"doc1",id:"doc1",isDocsHomePage:!1,title:"QueryPie Install Guide",description:"1. QueryPie Install Guide",source:"@site/docs/doc1.md",slug:"/",permalink:"/querypie-docs/docs/",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/doc1.md",version:"current",sidebar_label:"QueryPie Install Guide",sidebar:"someSidebar"},i=[],p={rightToc:i};function s(e){var t=e.components,c=Object(l.a)(e,["components"]);return Object(r.b)("wrapper",Object(n.a)({},p,c,{components:t,mdxType:"MDXLayout"}),Object(r.b)("h2",null,"1. QueryPie Install Guide"),Object(r.b)("h3",null,"1.1 Brief Architecture"),"* Install (Deploy) \uc744 \uc704\ud55c \uac04\ub2e8\ud55c \uad6c\uc870\ub97c \uc124\uba85\ud569\ub2c8\ub2e4.",Object(r.b)("p",null,"  ",Object(r.b)("img",{alt:"Public Zone",src:a(119).default})),Object(r.b)("h3",null,"1.2 Components"),"* \uc124\uba85",Object(r.b)("table",null,Object(r.b)("thead",{parentName:"table"},Object(r.b)("tr",{parentName:"thead"},Object(r.b)("th",Object(n.a)({parentName:"tr"},{align:"center"}),"\ucef4\ud3ec\ub10c\ud2b8 \uba85"),Object(r.b)("th",Object(n.a)({parentName:"tr"},{align:"center"}),"\uc124\uba85"))),Object(r.b)("tbody",{parentName:"table"},Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:"center"}),"QueryPie Api"),Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:"center"}),"Rest Api \uc11c\ubc84  & Admin")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:"center"}),"QueryPie App"),Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:"center"}),"QueryPie \uc758 Web Client")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:"center"}),"QueryPie DB"),Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:"center"}),"QueryPie \uac00 metadata \ub4e4\uc744 \uad00\ub9ac\ud558\ub294 DB")))),Object(r.b)("h2",{id:"2-mysql-install"},"2. QueryPie DB \uc124\uce58"),Object(r.b)("h3",null,"2.1 \uac1c\uc694"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"QueryPie \uc5d0\uc11c\ub294 \uad00\ub9ac\ud560 Database \ub4e4\uc758 metadata \ub97c \uc800\uc7a5\ud558\uae30 \uc704\ud558\uc5ec MySQL \uc11c\ubc84\ub97c \ud544\uc694\ub85c \ud569\ub2c8\ub2e4."),Object(r.b)("li",{parentName:"ul"},"mysql 5.7\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4."),Object(r.b)("li",{parentName:"ul"},"\uc124\uce58 \ubc0f \uc5c5\uadf8\ub808\uc774\ub4dc\uc2dc Table Schema \ub4e4\uc744 \uc801\uc6a9\ud558\uae30 \uc704\ud558\uc5ec DDL, DML \uad8c\ud55c\uc774 \ud544\uc694\ud569\ub2c8\ub2e4."),Object(r.b)("li",{parentName:"ul"},"Docker Image \ub97c \ub744\uc6b8 \ub54c \ud574\ub2f9 instance \uc758 \uc815\ubcf4\ub97c Option \uc5d0 \uc801\uc5b4 \uc8fc\uc5b4\uc57c \ud569\ub2c8\ub2e4.")),Object(r.b)("h3",null,"2.2 User \ubc0f DB \uc0dd\uc131 \uc608\uc81c"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"MySQL \uc124\uce58 \ud6c4 database\uc640 user\ub97c \uc0dd\uc131\ud574\uc8fc\uc5b4\uc57c \ud569\ub2c8\ub2e4."),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-mysql"}),"CREATE USER 'querypie'@'%' IDENTIFIED BY 'password';\n\nCREATE database querypie CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;\n\nGRANT ALL privileges ON querypie.* TO querypie@'%';\n"))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Helm \uc744 \uc774\uc6a9\ud55c \uc124\uce58\uc2dc\uc5d0\ub294 \uc544\ub798\uc5d0 MySQL\uc815\ubcf4\ub97c Setting\ud574 \uc8fc\uc2ed\uc2dc\uc624."),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-yaml"}),"  querypiedb:\n    DB_PORT: 3306\n    DB_HOST: ''\n    DB_DATABASE: ''\n    DB_MAX_CONNECTION_SIZE: 20\n    credentials:\n      DB_USERNAME: ''\n      DB_PASSWORD: ''\n")))),Object(r.b)("h2",{id:"3-redis-install"},"3. Redis \uc124\uce58 (Optional)"),Object(r.b)("h3",null,"3.1 \uac1c\uc694"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"QueryPie \uc5d0\uc11c\ub294 Redis \uc11c\ubc84\ub97c \ub0b4\ubd80\uc801\uc73c\ub85c \uc0ac\uc6a9\ud558\uba70, \uc124\uce58 \uc804 redis instance \uac00 \uc900\ube44\ub418\uc5b4 \uc788\uc5b4\uc57c \ud569\ub2c8\ub2e4."),Object(r.b)("li",{parentName:"ul"},"Redis 5 \uc774\uc0c1\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4."),Object(r.b)("li",{parentName:"ul"},"EKS \uc758 helm \uc744 \uc0ac\uc6a9\ud558\uc2dc\ub294 \ubd84\ub4e4\uc740 \uc790\ub3d9\uc73c\ub85c \uc124\uce58\uac00 \ub429\ub2c8\ub2e4."),Object(r.b)("li",{parentName:"ul"},"Docker Image \ub97c \ub744\uc6b8 \ub54c \ud574\ub2f9 instance \uc758 \uc815\ubcf4\ub97c Option \uc5d0 \uc801\uc5b4 \uc8fc\uc5b4\uc57c \ud569\ub2c8\ub2e4.")),Object(r.b)("h2",null,"4. QueryPie Docker Registry"),Object(r.b)("h3",null,"4.1 \uac1c\uc694"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"QueryPie \ub294 docker image\ub85c \uc804\ub2ec\ub429\ub2c8\ub2e4."),Object(r.b)("li",{parentName:"ul"},"QueryPie \uc758 \ucef4\ud3ec\ub10c\ud2b8\ub4e4\uc740 Private Docker Registry \uc5d0\uc11c \uad00\ub9ac\ud569\ub2c8\ub2e4."),Object(r.b)("li",{parentName:"ul"},"\uc778\uc99d \uc815\ubcf4\ub294 \uc124\uce58 \uac00\uc774\ub4dc\uc640 \ud568\uaed8 \uc804\ub2ec\ub429\ub2c8\ub2e4.")),Object(r.b)("h3",null,"4.2 Registry \uc815\ubcf4"),"* Private Registry",Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"domain name : dockerpie.querypie.com\npublic ip : 13.124.6.67\n")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"On-Premise \ud658\uacbd\uc5d0\uc11c \uc124\uce58\ud558\uc2dc\ub294 \ubd84\ub4e4\uc740 \uc704 registry \uc5d0 \uc811\uadfc\uc774 \uac00\ub2a5\ud558\ub3c4\ub85d Security Group \uc744 \uc870\uc815\ud574\uc8fc\uc2ed\uc2dc\uc624.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"helm \uc744 \ud1b5\ud574 \uc124\uce58\ud558\uc2dc\ub294 \ubd84\ub4e4\uc740 \ub2e4\uc74c\uc5d0\uc11c \uc9c0\uc815\uc774 \uac00\ub2a5\ud569\ub2c8\ub2e4."))),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-yaml"}),"imageCredentials:\n  registry: 'dockerpie.querypie.com'\n  username: 'username'\n  password: 'password'\n")),Object(r.b)("h2",null,"5. Deploy \uc608\uc81c"),Object(r.b)("h3",null,"5.1 \uac1c\uc694"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Public Zone \uc5d0\uc11c\uc758 Deploy \uad6c\uc131\ub3c4\ub97c \uc608\uc81c\ub85c \uc81c\uc2dc\ud569\ub2c8\ub2e4."),Object(r.b)("li",{parentName:"ul"},"Privacy Zone \uc5d0\uc11c\uc758 Deploy \uad6c\uc131\ub3c4\ub97c \uc608\uc81c\ub85c \uc81c\uc2dc\ud569\ub2c8\ub2e4.")),Object(r.b)("h3",null,"5.2 Public Zone \uc5d0\uc11c\uc758 Deploy \uad6c\uc131\ub3c4 \uc608\uc81c"),Object(r.b)("p",null,"  ",Object(r.b)("img",{alt:"Public Zone",src:a(119).default})),Object(r.b)("h3",null,"5.3 Privacy Zone \uc5d0\uc11c\uc758 Deploy \uad6c\uc131\ub3c4 \uc608\uc81c"),Object(r.b)("p",null," ",Object(r.b)("img",{alt:"Privacy Zone",src:a(135).default})),Object(r.b)("h2",null,"6. QueryPie \uc124\uce58 \ubc0f \uc5c5\ub370\uc774\ud2b8 - Helm"),Object(r.b)("h3",null,"6.1 Prerequisites"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"kubernetes \uc5d0 querypie\ub97c \uc124\uce58\ud558\ub294 \ubc29\ubc95\uc744 \uc124\uba85\ud569\ub2c8\ub2e4.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://helm.sh"}),"helm")," \uc744 \uc0ac\uc6a9\ud558\uc2dc\uae30\ub97c \uad8c\uc7a5\ud569\ub2c8\ub2e4.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"MySQL (>= 5.7.25) \uac00 \ud544\uc694\ud569\ub2c8\ub2e4."),Object(r.b)("p",{parentName:"li"},Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"#2-mysql-install"}),"QueryPie DB \uc124\uce58")," \ub97c \ucc38\uace0\ud574 \uc8fc\uc2ed\uc2dc\uc624.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Redis (>= 5) \uac00 \ud544\uc694\ud569\ub2c8\ub2e4. (Optional)"),Object(r.b)("p",{parentName:"li"},Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"#3-redis-install"}),"Redis \uc124\uce58")," \ub97c \ucc38\uace0\ud574 \uc8fc\uc2ed\uc2dc\uc624.\nhelm \uc744 \uc774\uc6a9\ud558\uc5ec \uc124\uce58\ub97c \ud558\uc2e4 \uacbd\uc6b0\uc5d0\ub294 \ub2e4\uc74c\uacfc \uac19\uc774 \uc124\uc815\ud574 \uc8fc\uc2dc\uba74 \ub530\ub85c redis \uc124\uce58\uac00 \ud544\uc694 \uc5c6\uc2b5\ub2c8\ub2e4."),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-yaml"}),"use_builtlin_redis: true\n")))),Object(r.b)("h3",null,"6.2 helm\uc744 \ud1b5\ud55c Install"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"helm \uc800\uc7a5\uc18c\ub97c \ucd94\uac00 \ud569\ub2c8\ub2e4."),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),"helm repo add chequer https://chequer-io.github.io/querypie-deployment/helm-chart\n"))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"helm \uc800\uc7a5\uc18c\ub97c update \ud569\ub2c8\ub2e4."),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),"helm repo update\n"))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"\uac01 \ud658\uacbd\uc5d0 \ub9de\ub294 values.yaml \ub97c \uc791\uc131\ud558\uc5ec QueryPie \ub97c install \ud569\ub2c8\ub2e4."),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),"helm install querypie chequer/querypie --create-namespace -n querypie -f xxxx-values.yaml --version=0.1.24\n")))),Object(r.b)("h3",null,"6.3 helm \uc744 \ud1b5\ud55c update"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"helm \uc744 \uc774\uc6a9\ud558\uc5ec \uc27d\uac8c update \ub97c \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),"helm upgrade querypie chequer/querypie -n querypie -f xxxx-values.yaml --version=0.1.24\n")))),Object(r.b)("h3",null,"6.4 Sample values.yaml - for EKS"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"\uc544\ub798\ub97c \ucc38\uace0 \ud558\uc2dc\uc5b4 xxxx-values.yaml \ub97c \uc791\uc131\ud574\uc8fc\uc2dc\uba74 \ub429\ub2c8\ub2e4."),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-yaml"}),'apiImage:\n  repository: dockerpie.querypie.com/chequer.io/querypie-api\n  tag: 8.1.6\n  pullPolicy: Always\n  replicas: 2\n\nappImage:\n  repository: dockerpie.querypie.com/chequer.io/querypie-app\n  tag: 8.1.6\n  pullPolicy: Always\n  replicas: 2\n\nquerypiedb:\n  DB_PORT: 3306\n  DB_HOST: \'\'\n  DB_DATABASE: \'\'\n  DB_MAX_CONNECTION_SIZE: 20\n  credentials:\n    DB_USERNAME: \'\'\n    DB_PASSWORD: \'\'\n\nimageCredentials:\n  registry: \'dockerpie.querypie.com\'\n  username: \'\'\n  password: \'\'\n\nappIngress:\n  tls: true\n  hostname: \'*.querypie.com\'\n  secretName: null\n  annotations:\n    kubernetes.io/ingress.class: alb\n    alb.ingress.kubernetes.io/scheme: internet-facing\n    alb.ingress.kubernetes.io/target-type: ip\n    alb.ingress.kubernetes.io/target-group-attributes: stickiness.enabled=true,stickiness.lb_cookie.duration_seconds=86400\n    alb.ingress.kubernetes.io/inbound-cidrs: 127.0.0.1/32, 172.0.0.1/32\n    alb.ingress.kubernetes.io/listen-ports: \'[{"HTTP":80}, {"HTTPS":443}]\'\n    alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:ap-northeast-2:xxxxx:certificate/xxxxx-4d47-493d-85b5-e4086b1e85c1\n    alb.ingress.kubernetes.io/actions.ssl-redirect: \'{"Type": "redirect", "RedirectConfig": { "Protocol": "HTTPS", "Port": "443", "StatusCode": "HTTP_301"}}\'\n    nginx.ingress.kubernetes.io/configuration-snippet: |\n      real_ip_header X-Forwarded-For;\n      set_real_ip_from 0.0.0.0/0;\n      proxy_set_header X-QueryPie-Company-Code $http_x-querypie-company-code;\n  rules:\n    - http:\n        paths:\n          - path: /*\n            backend:\n              serviceName: querypie-app-service\n              servicePort: 80\n\napiIngress:\n  tls: true\n  hostname: \'*.querypie.com\'\n  secretName: null\n  annotations:\n    kubernetes.io/ingress.class: alb\n    alb.ingress.kubernetes.io/scheme: internet-facing\n    alb.ingress.kubernetes.io/target-type: ip\n    alb.ingress.kubernetes.io/target-group-attributes: stickiness.enabled=true,stickiness.lb_cookie.duration_seconds=86400\n    alb.ingress.kubernetes.io/inbound-cidrs: 127.0.0.1/32, 172.0.0.1/32\n    alb.ingress.kubernetes.io/listen-ports: \'[{"HTTP":80}, {"HTTPS":443}]\'\n    alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:ap-northeast-2:xxxxx:certificate/xxxx-4d47-493d-85b5-e4086b1e85c1\n    alb.ingress.kubernetes.io/actions.ssl-redirect: \'{"Type": "redirect", "RedirectConfig": { "Protocol": "HTTPS", "Port": "443", "StatusCode": "HTTP_301"}}\'\n    nginx.ingress.kubernetes.io/configuration-snippet: |\n      real_ip_header X-Forwarded-For;\n      set_real_ip_from 0.0.0.0/0;\n      proxy_set_header X-QueryPie-Company-Code $http_x-querypie-company-code;\n  rules:\n    - http:\n        paths:\n          - path: /*\n            backend:\n              serviceName: querypie-api-service\n              servicePort: 80\n\nuse_intenal_redis: true\n')))),Object(r.b)("h2",null,"7. EKS \uc124\uc815"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"querypie\ub97c AWS\uc0c1\uc5d0\uc11c \ud6a8\uc728\uc801\uc73c\ub85c \uc124\uce58\ud558\uace0 \ucd5c\uc2e0\uc73c\ub85c \uc720\uc9c0\ud558\ub294 \ubc29\ubc95\uc740 EKS\uc0c1\uc5d0\uc11c \uc6b4\uc601\ud558\ub294 \uac83\uc785\ub2c8\ub2e4.")),Object(r.b)("h3",null,"7.1 QueryPie\ub97c \uc704\ud55c EKS cluster \uc0dd\uc131"),"* \uc774\ubbf8 \uae30\uc874\uc758 cluster\uac00 \uc788\uc73c\uc2dc\uac70\ub098, \uc775\uc219\ud558\uc2e0 \ubd84\ub4e4\uc740 \uc774 \ub2e8\uacc4\ub97c \uac74\ub108 \ub6f0\uc2ed\uc2dc\uc624.",Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"cluster\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4."),Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"\uc6d0\ud558\uc2dc\ub294 region\uc5d0\uc11c ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://ap-northeast-2.console.aws.amazon.com/eks/home?region=ap-northeast-2#/cluster-create"}),"EKS > Clusters > Create EKS cluster"),"\ub97c \ud074\ub9ad\ud558\uc5ec \uc9c4\ud589\ud569\ub2c8\ub2e4."),Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"version\uc740 1.18 \uc774\uc0c1\uc744 \uc120\ud0dd\ud569\ub2c8\ub2e4.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Cluster Service Role\uc5d0\uc11c\ub294 \uc704\uc5d0\uc11c \uc0dd\uc131\ud55c ",Object(r.b)("strong",null,"iam_querypie_cluster")," \ub97c \uc120\ud0dd\ud569\ub2c8\ub2e4.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Tags\ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4. (optional)"))),Object(r.b)("p",{parentName:"li"},Object(r.b)("img",{alt:"Public Zone",src:a(136).default})),Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},"Netwoking\uc740 \uc124\uce58 \ub418\ub294 \ud658\uacbd\uc5d0 \ub9de\ucd94\uc5b4 \uc124\uc815\ud569\ub2c8\ub2e4.")),Object(r.b)("p",{parentName:"li"},Object(r.b)("img",{alt:"Public Zone",src:a(137).default})),Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},"Logging\uc740 \ucf1c\uc2dc\ub294 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. (optional)")),Object(r.b)("p",{parentName:"li"},Object(r.b)("img",{alt:"Public Zone",src:a(138).default})),Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},"Review \ud6c4 \uc0dd\uc131 \uc644\ub8cc\ud569\ub2c8\ub2e4.")),Object(r.b)("p",{parentName:"li"},Object(r.b)("img",{alt:"Public Zone",src:a(139).default}))))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"QueryPie \uc758 \uacbd\uc6b0 AWS Load Balancer Controller\ub97c \uc124\uce58 \ud569\ub2c8\ub2e4."),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-html"}),"https://github.com/kubernetes-sigs/aws-load-balancer-controller\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://kubernetes-sigs.github.io/aws-load-balancer-controller/latest/deploy/installation/"}),"Load Balancer Controller Installation")," \uc744 \ucc38\uace0\ud574\uc8fc\uc2ed\uc2dc\uc624."))),Object(r.b)("h2",null,"8. GKE \uc124\uc815"),Object(r.b)("h3",null,"8.1 Prerequisites"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"querypie\ub97c GCP\uc0c1\uc5d0\uc11c \ud6a8\uc728\uc801\uc73c\ub85c \uc124\uce58\ud558\uace0 \ucd5c\uc2e0\uc73c\ub85c \uc720\uc9c0\ud558\ub294 \ubc29\ubc95\uc740 GKE\uc0c1\uc5d0\uc11c \uc6b4\uc601\ud558\ub294 \uac83\uc785\ub2c8\ub2e4.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://cloud.google.com/sdk/docs/install"}),"Google Cloud Sdk")," \ub97c \uba3c\uc800 \uc124\uce58\ud574\uc8fc\uc2ed\uc2dc\uc624.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"kubernetes api\ub97c enable \ud574\uc8fc\uc2ed\uc2dc\uc624."),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),"gcloud services enable container.googleapis.com\n"))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"IAM Service Account Credentials api\ub97c enable \ud574\uc8fc\uc2ed\uc2dc\uc624."),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"})," gcloud services enable iamcredentials.googleapis.com\n"))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"sqladmin api \ub97c enable \ud574\uc8fc\uc2ed\uc2dc\uc624."),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),"gcloud services enable sqladmin.googleapis.com\n"))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"\ub2e4\uc74c\uc758 \uad8c\ud55c\ub4e4\uc774 \ud544\uc694\ud569\ub2c8\ub2e4."),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),"container.clusters.create\ncontainer.clusters.update\niam.serviceAccounts.setIamPolicy\n")))),Object(r.b)("h3",null,"8.2 Project \uc0dd\uc131"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"\uc774\ubbf8 project\uac00 \uc0dd\uc131\ub418\uc5b4 \uc788\ub2e4\uba74 \uc774 \uacfc\uc815\uc740 \uc0dd\ub7b5\ud574\uc8fc\uc2ed\uc2dc\uc624."),Object(r.b)("pre",null,Object(r.b)("code",{lang:"shell script"},"gcloud projects create ",Object(r.b)("b",null,"PROJECT_ID")," --organization=",Object(r.b)("b",null,"RGANIZATION_ID"))),Object(r.b)("p",{parentName:"li"},"\uc608\uc81c)."),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),"gcloud projects create querypie --organization=614642268215\n")))),Object(r.b)("h3",null,"8.3 GKE Cluster \uc0dd\uc131"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"\uc774\ubbf8 cluster\uac00 \uc0dd\uc131\ub418\uc5b4 \uc788\ub2e4\uba74 \uc774 \uacfc\uc815\uc740 \uc0dd\ub7b5\ud574\uc8fc\uc2ed\uc2dc\uc624."),Object(r.b)("pre",null,Object(r.b)("code",{lang:"shell script"},"gcloud container clusters create querypie --zone ",Object(r.b)("b",null,"ZONE_ID")," --project ",Object(r.b)("b",null,"PROJECT_ID")," --workload-pool=",Object(r.b)("b",null,"PROJECT_ID"),".svc.id.goog --workload-metadata=GKE_METADATA")),Object(r.b)("p",{parentName:"li"},"\uc608\uc81c)."),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),"gcloud container clusters create querypie --zone asia-northeast3-a --project chequer --workload-pool=querypie.svc.id.goog --workload-metadata=GKE_METADATA\n"))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"\uc0dd\uc131\ub41c cluster\ub294 \ub2e4\uc74c\uacfc \uac19\uc774 \ud655\uc778\uc774 \uac00\ub2a5\ud569\ub2c8\ub2e4."),Object(r.b)("p",{parentName:"li"}," \uc608\uc81c)."),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),"gcloud container clusters describe querypie --zone 'asia-northeast3-a'\n"))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"cluster\uc640 \ud1b5\uc2e0\ud558\uae30 \uc704\ud558\uc5ec kubectl \uc744 \uad6c\uc131\ud569\ub2c8\ub2e4."),Object(r.b)("p",{parentName:"li"}," \uc608\uc81c)."),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),"gcloud container clusters get-credentials querypie --zone asia-northeast3-a --project querypie\n")))),Object(r.b)("h3",null,"8.4 Google Service Account \uc0dd\uc131"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"google service account\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4."),Object(r.b)("pre",null,Object(r.b)("code",{lang:"shell"},"gcloud iam service-accounts create ",Object(r.b)("b",null,"GSA_NAME"))),Object(r.b)("p",{parentName:"li"}," \uc608\uc81c)."),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),"gcloud iam service-accounts create querypie\n"))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"google service account\ub97c \ub9cc\ub4e4\uace0 \uc774\ub97c kubernetes\uc758 service account\uac00 google service account\ub85c \ub3d9\uc791\ud558\ub3c4\ub85d \ud5c8\uc6a9\ud569\ub2c8\ub2e4."),Object(r.b)("pre",null,Object(r.b)("code",{lang:"shell"},'gcloud iam service-accounts add-iam-policy-binding \\ --role roles/iam.workloadIdentityUser \\ --member "serviceAccount:querypie.svc.id.goog[',Object(r.b)("b",null,"K8S_NAMESPACE"),"/",Object(r.b)("b",null,"KSA_NAME"),']" \\',Object(r.b)("b",null,"GSA_NAME"),"@",Object(r.b)("b",null,"PROJECT_ID"),".iam.gserviceaccount.com")),Object(r.b)("p",{parentName:"li"},"\uc608\uc81c).")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"\uae30\uc874\uc5d0 \uc124\uce58\ub41c querypie\uac00 \uc788\ub2e4\uba74 \ub2e4\uc74c\uacfc \uac19\uc774 kubernetes \uc758 service account\uc5d0 annotation\uc744 \ucd94\uac00\ud574\uc90d\ub2c8\ub2e4."),Object(r.b)("pre",null,Object(r.b)("code",{lang:"shell"},"kubectl annotate serviceaccount \\ --namespace ",Object(r.b)("b",null,"K8S_NAMESPACE")," \\",Object(r.b)("b",null,"KSA_NAME")," \\ iam.gke.io/gcp-service-account=GSA_NAME@PROJECT_ID.iam.gserviceaccount.com")),Object(r.b)("p",{parentName:"li"},"\uc608\uc81c)."),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),"kubectl annotate serviceaccount \\\n--namespace <b>querypie</b> \\\n<b>querypie</b> \\\niam.gke.io/gcp-service-account=querypie@querypie.iam.gserviceaccount.com\n")))),Object(r.b)("h3",null,"8.5. Tips"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"\ub2e4\uc74c\uc744 \ubbf8\ub9ac \ud658\uacbd\ubcc0\uc218\uc5d0 \uc9c0\uc815\ud574 \ub450\uc2dc\uba74 ZONE, CLUSTER, PROJECT\ub97c \ub9e4\ubc88 gcloud\uc758 parameter\ub85c \ub118\uae30\uc9c0 \uc54a\uc73c\uc154\ub3c4 \ub429\ub2c8\ub2e4."),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),' export PROJECT=$(gcloud config list project --format "value(core.project)" )\n export CLUSTER=workload-id\n export ZONE=asia-northeast3-a\n gcloud config set compute/zone $ZONE\n gcloud config set compute/region asia-northeast3-a\n')))))}s.isMDXComponent=!0}}]);