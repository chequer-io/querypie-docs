"use strict";(self.webpackChunkquerypie_docs=self.webpackChunkquerypie_docs||[]).push([[739],{3905:function(e,t,a){a.d(t,{Zo:function(){return u},kt:function(){return k}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function p(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var o=n.createContext({}),s=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=s(e.components);return n.createElement(o.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,o=e.parentName,u=p(e,["components","mdxType","originalType","parentName"]),c=s(a),k=r,d=c["".concat(o,".").concat(k)]||c[k]||m[k]||l;return a?n.createElement(d,i(i({ref:t},u),{},{components:a})):n.createElement(d,i({ref:t},u))}));function k(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,i=new Array(l);i[0]=c;var p={};for(var o in t)hasOwnProperty.call(t,o)&&(p[o]=t[o]);p.originalType=e,p.mdxType="string"==typeof e?e:r,i[1]=p;for(var s=2;s<l;s++)i[s]=a[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},8290:function(e,t,a){a.r(t),a.d(t,{assets:function(){return u},contentTitle:function(){return o},default:function(){return k},frontMatter:function(){return p},metadata:function(){return s},toc:function(){return m}});var n=a(7462),r=a(3366),l=(a(7294),a(3905)),i=["components"],p={id:"doc1",title:"QueryPie Install Guide",sidebar_label:"QueryPie Install Guide",slug:"/"},o=void 0,s={unversionedId:"doc1",id:"doc1",title:"QueryPie Install Guide",description:"1. QueryPie Install Guide",source:"@site/docs/doc1.md",sourceDirName:".",slug:"/",permalink:"/querypie-docs/docs/",draft:!1,editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/doc1.md",tags:[],version:"current",frontMatter:{id:"doc1",title:"QueryPie Install Guide",sidebar_label:"QueryPie Install Guide",slug:"/"},sidebar:"someSidebar"},u={},m=[],c={toc:m};function k(e){var t=e.components,p=(0,r.Z)(e,i);return(0,l.kt)("wrapper",(0,n.Z)({},c,p,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h2",null,"1. QueryPie Install Guide"),(0,l.kt)("h3",null,"1.1 Brief Architecture"),"* Install (Deploy) \uc744 \uc704\ud55c \uac04\ub2e8\ud55c \uad6c\uc870\ub97c \uc124\uba85\ud569\ub2c8\ub2e4.",(0,l.kt)("p",null,"  ",(0,l.kt)("img",{alt:"Public Zone",src:a(3054).Z,width:"1902",height:"1436"})),(0,l.kt)("h3",null,"1.2 Components"),"* \uc124\uba85",(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:"left"},"\ucef4\ud3ec\ub10c\ud2b8 \uba85"),(0,l.kt)("th",{parentName:"tr",align:"left"},"\uc124\uba85"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"QueryPie Api"),(0,l.kt)("td",{parentName:"tr",align:"left"},"User, Policy, Meta Data\ub4f1\uc744 \uad00\ub9ac\ud558\ub294 Rest Api \uc11c\ubc84")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"QueryPie App"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Web Sql Client, Management Console")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"QueryPie Proxy"),(0,l.kt)("td",{parentName:"tr",align:"left"},"DataGrip, Workbench\ub97c \uc704\ud55c Proxy \uc11c\ubc84")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"QueryPie DB"),(0,l.kt)("td",{parentName:"tr",align:"left"},"QueryPie \uac00 metadata \ub4e4\uc744 \uad00\ub9ac\ud558\ub294 DB")))),(0,l.kt)("h2",{id:"2-mysql-install"},"2. QueryPie DB \uc124\uce58"),(0,l.kt)("h3",null,"2.1 \uac1c\uc694"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"QueryPie \uc5d0\uc11c\ub294 \uad00\ub9ac\ud560 Database \ub4e4\uc758 metadata \ub97c \uc800\uc7a5\ud558\uae30 \uc704\ud558\uc5ec MySQL \uc11c\ubc84\ub97c \ud544\uc694\ub85c \ud569\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ul"},"mysql 5.7\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ul"},"\uc124\uce58 \ubc0f \uc5c5\uadf8\ub808\uc774\ub4dc\uc2dc Table Schema \ub4e4\uc744 \uc801\uc6a9\ud558\uae30 \uc704\ud558\uc5ec DDL, DML \uad8c\ud55c\uc774 \ud544\uc694\ud569\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ul"},"Docker Image \ub97c \ub744\uc6b8 \ub54c \ud574\ub2f9 instance \uc758 \uc815\ubcf4\ub97c Option \uc5d0 \uc801\uc5b4 \uc8fc\uc5b4\uc57c \ud569\ub2c8\ub2e4.")),(0,l.kt)("h3",null,"2.2 User \ubc0f DB \uc0dd\uc131 \uc608\uc81c"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"MySQL \uc124\uce58 \ud6c4 database\uc640 user\ub97c \uc0dd\uc131\ud574\uc8fc\uc5b4\uc57c \ud569\ub2c8\ub2e4."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-mysql"},"CREATE USER 'querypie'@'%' IDENTIFIED BY 'password';\n\nCREATE database querypie CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;\n\nGRANT ALL privileges ON querypie.* TO querypie@'%';\n"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Helm \uc744 \uc774\uc6a9\ud55c \uc124\uce58\uc2dc\uc5d0\ub294 xxx-values.yml\uc5d0 \uc774 MySQL\uc815\ubcf4\ub97c Setting\ud574 \uc8fc\uc2ed\uc2dc\uc624."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"  querypiedb:\n    DB_PORT: 3306\n    DB_HOST: ''\n    DB_DATABASE: ''\n    DB_MAX_CONNECTION_SIZE: 20\n    credentials:\n      DB_USERNAME: ''\n      DB_PASSWORD: ''\n")))),(0,l.kt)("h2",{id:"3-redis-install"},"3. Redis \uc124\uce58 (Optional)"),(0,l.kt)("h3",null,"3.1 \uac1c\uc694"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"QueryPie \uc5d0\uc11c\ub294 Redis \uc11c\ubc84\ub97c \ub0b4\ubd80\uc801\uc73c\ub85c \uc0ac\uc6a9\ud558\uba70, \uc124\uce58 \uc804 redis instance \uac00 \uc900\ube44\ub418\uc5b4 \uc788\uc5b4\uc57c \ud569\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ul"},"Redis 5 \uc774\uc0c1\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ul"},"EKS \uc758 helm \uc744 \uc0ac\uc6a9\ud558\uc2dc\ub294 \uacbd\uc6b0\uc5d0\ub294 \ub0b4\ubd80\uc758 Redis\ub97c \uc0ac\uc6a9\ud558\ubbc0\ub85c \ub530\ub85c \uc124\uce58\uac00 \ud544\uc694 \uc5c6\uc2b5\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ul"},"Docker Image \ub97c \ub744\uc6b8 \ub54c \ud574\ub2f9 instance \uc758 \uc815\ubcf4\ub97c Option \uc5d0 \uc801\uc5b4 \uc8fc\uc5b4\uc57c \ud569\ub2c8\ub2e4.")),(0,l.kt)("h2",null,"4. QueryPie Docker Registry"),(0,l.kt)("h3",null,"4.1 \uac1c\uc694"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"QueryPie \ub294 docker image\ub85c \uc804\ub2ec\ub429\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ul"},"QueryPie \uc758 \ucef4\ud3ec\ub10c\ud2b8\ub4e4\uc740 Private Docker Registry \uc5d0\uc11c \uad00\ub9ac\ud569\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ul"},"\uc778\uc99d \uc815\ubcf4\ub294 \uc124\uce58 \uac00\uc774\ub4dc\uc640 \ud568\uaed8 \uc804\ub2ec\ub429\ub2c8\ub2e4.")),(0,l.kt)("h3",null,"4.2 Registry \uc815\ubcf4"),"* Private Registry",(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"domain name : dockerpie.querypie.com\npublic ip : 13.124.6.67\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"On-Premise \ud658\uacbd\uc5d0\uc11c \uc124\uce58\ud558\uc2dc\ub294 \ubd84\ub4e4\uc740 \uc704 registry \uc5d0 \uc811\uadfc\uc774 \uac00\ub2a5\ud558\ub3c4\ub85d Security Group \uc744 \uc870\uc815\ud574\uc8fc\uc2ed\uc2dc\uc624.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"helm \uc744 \ud1b5\ud574 \uc124\uce58\ud558\uc2dc\ub294 \ubd84\ub4e4\uc740 \ub2e4\uc74c\uc5d0\uc11c \uc9c0\uc815\uc774 \uac00\ub2a5\ud569\ub2c8\ub2e4."))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"imageCredentials:\n  registry: 'dockerpie.querypie.com'\n  username: 'username'\n  password: 'password'\n")),(0,l.kt)("h2",null,"5. Deploy \uc608\uc81c"),(0,l.kt)("h3",null,"5.1 \uac1c\uc694"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\ub2e8\uc77c Zone \uc5d0\uc11c\uc758 Deploy \uad6c\uc131\ub3c4\ub97c \uc608\uc81c\ub85c \uc81c\uc2dc\ud569\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ul"},"\uc5ec\ub7ec Zone \uc5d0\uc11c\uc758 Deploy \uad6c\uc131\ub3c4\ub97c \uc608\uc81c\ub85c \uc81c\uc2dc\ud569\ub2c8\ub2e4.")),(0,l.kt)("h3",null,"5.2 \ub2e8\uc77c Zone \uc5d0\uc11c\uc758 Deploy \uad6c\uc131\ub3c4 \uc608\uc81c"),(0,l.kt)("p",null,"  ",(0,l.kt)("img",{alt:"Public Zone",src:a(3054).Z,width:"1902",height:"1436"})),(0,l.kt)("h3",null,"5.3 \uc5ec\ub7ec Zone \uc5d0\uc11c\uc758 Deploy \uad6c\uc131\ub3c4 \uc608\uc81c"),"* Privacy Zone \ub4f1 \uc5ec\ub7ec Network Zone\uc73c\ub85c DB\uac00 \ub098\ub204\uc5b4\uc838 \uc788\uc73c\ub098 \ubaa8\ub4e0 Zone\ub4e4\uc758 DB \ub294 QueryPie Api\uc11c\ubc84\uac00 \ub2f4\ub2f9\ud558\uac8c \ub429\ub2c8\ub2e4. * \ub2e4\uc74c\uacfc \uac19\uc740 \uad6c\uc131\uc73c\ub85c \uc5ec\ub7ec Zone\uc758 DB\ub4e4\uc744 \ud55c\uad70\ub370\uc5d0\uc11c \uad00\ub9ac \uac00\ub2a5\ud569\ub2c8\ub2e4. * \uc0ac\uc6a9\uc790 client\ub97c \uc81c\uc678\ud55c \uad6c\uc131\ub3c4 \uc785\ub2c8\ub2e4.",(0,l.kt)("p",null," ",(0,l.kt)("img",{alt:"Privacy Zone",src:a(3615).Z,width:"2238",height:"1388"})),(0,l.kt)("h3",null,"5.4 \ud544\uc694\ud55c Protocol / Port"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\ud3ec\ud2b8\ub294 \uac01 \uc0ac\uc758 \uc815\ucc45\uc5d0 \ub530\ub77c \ubcc0\uacbd \uac00\ub2a5\ud569\ub2c8\ub2e4. \ubb38\uc758 \ubd80\ud0c1\ub4dc\ub9bd\ub2c8\ub2e4.")),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:"left"},"\ub124\ud2b8\uc6cc\ud06c \uad6c\uac04"),(0,l.kt)("th",{parentName:"tr",align:"left"},"Protocol / Port"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"Office, VDI ->  QueryPie App"),(0,l.kt)("td",{parentName:"tr",align:"left"},"https / 443")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"Office, VDI -> QueryPie Proxy"),(0,l.kt)("td",{parentName:"tr",align:"left"},"TCP / 40000:49999")))),(0,l.kt)("h2",null,"6. QueryPie \uc124\uce58 \ubc0f \uc5c5\ub370\uc774\ud2b8 - Helm"),(0,l.kt)("h3",null,"6.1 Prerequisites"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"kubernetes \uc5d0 querypie\ub97c \uc124\uce58\ud558\ub294 \ubc29\ubc95\uc744 \uc124\uba85\ud569\ub2c8\ub2e4.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"EKS\ub97c \uc0ac\uc6a9\ud558\uc2dc\ub294 \ubd84\ub4e4\uc740 ",(0,l.kt)("a",{parentName:"p",href:"#7-eks-setting"},"EKS \uc124\uc815")," \ub97c \ucc38\uace0\ud574\uc8fc\uc2ed\uc2dc\uc624.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"GKE\ub97c \uc0ac\uc6a9\ud558\uc2dc\ub294 \ubd84\ub4e4\uc740 ",(0,l.kt)("a",{parentName:"p",href:"#8-gke-setting"},"GKE \uc124\uc815")," \ub97c \ucc38\uace0\ud574\uc8fc\uc2ed\uc2dc\uc624.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("a",{parentName:"p",href:"https://helm.sh"},"helm")," \uc744 \uc0ac\uc6a9\ud558\uc2dc\uae30\ub97c \uad8c\uc7a5\ud569\ub2c8\ub2e4.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"MySQL (>= 5.7.25) \uac00 \ud544\uc694\ud569\ub2c8\ub2e4."),(0,l.kt)("p",{parentName:"li"},(0,l.kt)("a",{parentName:"p",href:"#2-mysql-install"},"QueryPie DB \uc124\uce58")," \ub97c \ucc38\uace0\ud574 \uc8fc\uc2ed\uc2dc\uc624.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Redis (>= 5) \uac00 \ud544\uc694\ud569\ub2c8\ub2e4. (Optional)"),(0,l.kt)("p",{parentName:"li"},(0,l.kt)("a",{parentName:"p",href:"#3-redis-install"},"Redis \uc124\uce58")," \ub97c \ucc38\uace0\ud574 \uc8fc\uc2ed\uc2dc\uc624.\nhelm\uc744 \uc774\uc6a9\ud558\uc5ec \uc124\uce58\ub97c \ud558\uc2e4 \uacbd\uc6b0\uc5d0\ub294 \ub2e4\uc74c\uacfc \uac19\uc774 \uc124\uc815\ud574 \uc8fc\uc2dc\uba74 \ub530\ub85c redis \uc124\uce58\uac00 \ud544\uc694 \uc5c6\uc2b5\ub2c8\ub2e4."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"use_builtlin_redis: true\n")))),(0,l.kt)("h3",null,"6.2 helm\uc744 \ud1b5\ud55c Install"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"helm \uc800\uc7a5\uc18c\ub97c \ucd94\uac00 \ud569\ub2c8\ub2e4."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"helm repo add chequer https://chequer-io.github.io/querypie-deployment/helm-chart\n"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"helm \uc800\uc7a5\uc18c\ub97c update \ud569\ub2c8\ub2e4."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"helm repo update\n"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\uac01 \ud658\uacbd\uc5d0 \ub9de\ub294 values.yaml \ub97c \uc791\uc131\ud558\uc5ec QueryPie \ub97c install \ud569\ub2c8\ub2e4."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"helm install querypie chequer/querypie --create-namespace -n querypie -f xxxx-values.yaml\n")))),(0,l.kt)("h3",null,"6.3 helm \uc744 \ud1b5\ud55c update"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"helm \uc744 \uc774\uc6a9\ud558\uc5ec \uc27d\uac8c update \ub97c \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"helm upgrade querypie chequer/querypie -n querypie -f xxxx-values.yaml\n")))),(0,l.kt)("h3",null,"6.4 Sample values.yaml - for EKS"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\uc544\ub798\ub97c \ucc38\uace0 \ud558\uc2dc\uc5b4 xxxx-values.yaml \ub97c \uc791\uc131\ud574\uc8fc\uc2dc\uba74 \ub429\ub2c8\ub2e4."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'apiImage:\n  repository: dockerpie.querypie.com/chequer.io/querypie-api\n  tag: 8.2.1\n  pullPolicy: Always\n  replicas: 2\n\nappImage:\n  repository: dockerpie.querypie.com/chequer.io/querypie-app\n  tag: 8.2.1\n  pullPolicy: Always\n  replicas: 2\n\nproxyImage:\n  repository: dockerpie.querypie.com/chequer.io/querypie-app\n  tag: 8.2.1\n  pullPolicy: Always\n  replicas: 2\n\nquerypiedb:\n  DB_PORT: 3306\n  DB_HOST: \'\'\n  DB_DATABASE: \'\'\n  DB_MAX_CONNECTION_SIZE: 20\n  credentials:\n    DB_USERNAME: \'\'\n    DB_PASSWORD: \'\'\n\nimageCredentials:\n  registry: \'dockerpie.querypie.com\'\n  username: \'\'\n  password: \'\'\n\nappIngress:\n  tls: true\n  hostname: \'*.querypie.com\'\n  secretName: null\n  annotations:\n    kubernetes.io/ingress.class: alb\n    alb.ingress.kubernetes.io/scheme: internet-facing\n    alb.ingress.kubernetes.io/target-type: ip\n    alb.ingress.kubernetes.io/target-group-attributes: stickiness.enabled=true,stickiness.lb_cookie.duration_seconds=86400\n    alb.ingress.kubernetes.io/inbound-cidrs: 127.0.0.1/32, 172.0.0.1/32\n    alb.ingress.kubernetes.io/listen-ports: \'[{"HTTP":80}, {"HTTPS":443}]\'\n    alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:ap-northeast-2:xxxxx:certificate/xxxxx-4d47-493d-85b5-e4086b1e85c1\n    alb.ingress.kubernetes.io/actions.ssl-redirect: \'{"Type": "redirect", "RedirectConfig": { "Protocol": "HTTPS", "Port": "443", "StatusCode": "HTTP_301"}}\'\n    nginx.ingress.kubernetes.io/configuration-snippet: |\n      real_ip_header X-Forwarded-For;\n      set_real_ip_from 0.0.0.0/0;\n      proxy_set_header X-QueryPie-Company-Code $http_x-querypie-company-code;\n  rules:\n    - http:\n        paths:\n          - path: /*\n            backend:\n              serviceName: querypie-app-service\n              servicePort: 80\n\napiIngress:\n  tls: true\n  hostname: \'*.querypie.com\'\n  secretName: null\n  annotations:\n    kubernetes.io/ingress.class: alb\n    alb.ingress.kubernetes.io/scheme: internet-facing\n    alb.ingress.kubernetes.io/target-type: ip\n    alb.ingress.kubernetes.io/target-group-attributes: stickiness.enabled=true,stickiness.lb_cookie.duration_seconds=86400\n    alb.ingress.kubernetes.io/inbound-cidrs: 127.0.0.1/32, 172.0.0.1/32\n    alb.ingress.kubernetes.io/listen-ports: \'[{"HTTP":80}, {"HTTPS":443}]\'\n    alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:ap-northeast-2:xxxxx:certificate/xxxx-4d47-493d-85b5-e4086b1e85c1\n    alb.ingress.kubernetes.io/actions.ssl-redirect: \'{"Type": "redirect", "RedirectConfig": { "Protocol": "HTTPS", "Port": "443", "StatusCode": "HTTP_301"}}\'\n    nginx.ingress.kubernetes.io/configuration-snippet: |\n      real_ip_header X-Forwarded-For;\n      set_real_ip_from 0.0.0.0/0;\n      proxy_set_header X-QueryPie-Company-Code $http_x-querypie-company-code;\n  rules:\n    - http:\n        paths:\n          - path: /*\n            backend:\n              serviceName: querypie-api-service\n              servicePort: 80\n\nuse_builtin_redis: true\n')))),(0,l.kt)("h2",{id:"7-eks-setting"},"7. EKS \uc124\uc815"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"QueryPie\ub97c AWS\uc0c1\uc5d0\uc11c \ud6a8\uc728\uc801\uc73c\ub85c \uc124\uce58\ud558\uace0 \ucd5c\uc2e0\uc73c\ub85c \uc720\uc9c0\ud558\ub294 \ubc29\ubc95\uc740 EKS\uc0c1\uc5d0\uc11c \uc6b4\uc601\ud558\ub294 \uac83\uc785\ub2c8\ub2e4.")),(0,l.kt)("h3",null,"7.1 QueryPie\ub97c \uc704\ud55c EKS cluster \uc0dd\uc131"),"* \uc774\ubbf8 \uae30\uc874\uc758 cluster\uac00 \uc788\uc73c\uc2dc\uac70\ub098, \uc775\uc219\ud558\uc2e0 \ubd84\ub4e4\uc740 \uc774 \ub2e8\uacc4\ub97c \uac74\ub108 \ub6f0\uc2ed\uc2dc\uc624.",(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"cluster\ub97c \uc704\ud55c IAM Role\uc744 ",(0,l.kt)("a",{parentName:"p",href:"https://console.aws.amazon.com/iam/home?region=ap-northeast-2#/roles$new?step=type"},"\uc0dd\uc131"),"\ud569\ub2c8\ub2e4."),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\uc774 \uac00\uc774\ub4dc\uc5d0\uc11c\ub294 ",(0,l.kt)("strong",null,"iam_querypie_cluster"),"\uc758 \uc774\ub984\uc73c\ub85c \uc0dd\uc131\ud569\ub2c8\ub2e4."),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"type\uc740 EKS - Cluster\ub97c \uc120\ud0dd\ud569\ub2c8\ub2e4.")),(0,l.kt)("p",{parentName:"li"},(0,l.kt)("img",{alt:"Public Zone",src:a(3892).Z,width:"999",height:"272"})),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Attached Permissions \ub97c \ud655\uc778\ud569\ub2c8\ub2e4.")),(0,l.kt)("p",{parentName:"li"},(0,l.kt)("img",{alt:"Public Zone",src:a(3954).Z,width:"993",height:"766"})),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\ud544\uc694\ud55c Tagging\uc744 \uc9c4\ud589\ud569\ub2c8\ub2e4. (Optional)")),(0,l.kt)("p",{parentName:"li"},(0,l.kt)("img",{alt:"Public Zone",src:a(3625).Z,width:"1009",height:"413"})),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\ud655\uc778 \ud6c4 \uc0dd\uc131\uc744 \uc644\ub8cc\ud569\ub2c8\ub2e4.")),(0,l.kt)("p",{parentName:"li"},(0,l.kt)("img",{alt:"Public Zone",src:a(3388).Z,width:"1014",height:"622"})))))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"cluster\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4."),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\uc6d0\ud558\uc2dc\ub294 region\uc5d0\uc11c ",(0,l.kt)("a",{parentName:"p",href:"https://ap-northeast-2.console.aws.amazon.com/eks/home?region=ap-northeast-2#/cluster-create"},"EKS > Clusters > Create EKS cluster"),"\ub97c \ud074\ub9ad\ud558\uc5ec \uc9c4\ud589\ud569\ub2c8\ub2e4."),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"version\uc740 1.18 \uc774\uc0c1\uc744 \uc120\ud0dd\ud569\ub2c8\ub2e4.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Cluster Service Role\uc5d0\uc11c\ub294 \uc704\uc5d0\uc11c \uc0dd\uc131\ud55c ",(0,l.kt)("strong",null,"iam_querypie_cluster")," \ub97c \uc120\ud0dd\ud569\ub2c8\ub2e4.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Tags\ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4. (optional)"))),(0,l.kt)("p",{parentName:"li"},(0,l.kt)("img",{alt:"Public Zone",src:a(6681).Z,width:"892",height:"911"})),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Netwoking\uc740 \uc124\uce58 \ub418\ub294 \ud658\uacbd\uc5d0 \ub9de\ucd94\uc5b4 \uc124\uc815\ud569\ub2c8\ub2e4.")),(0,l.kt)("p",{parentName:"li"},(0,l.kt)("img",{alt:"Public Zone",src:a(5878).Z,width:"880",height:"1247"})),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Logging\uc740 \ucf1c\uc2dc\ub294 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. (optional)")),(0,l.kt)("p",{parentName:"li"},(0,l.kt)("img",{alt:"Public Zone",src:a(9847).Z,width:"891",height:"694"})),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Review \ud6c4 \uc0dd\uc131 \uc644\ub8cc\ud569\ub2c8\ub2e4.")),(0,l.kt)("p",{parentName:"li"},(0,l.kt)("img",{alt:"Public Zone",src:a(9814).Z,width:"904",height:"1213"}))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Node Group\uc744 \uc704\ud55c IAM\uc744 \uc0dd\uc131\ud569\ub2c8\ub2e4."),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Node Group\uc744 \uc704\ud55c \ud544\uc218 IAM Policy\ub294 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4."),(0,l.kt)("table",{parentName:"li"},(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:"left"},"Policy"),(0,l.kt)("th",{parentName:"tr",align:"left"},"\ube44\uace0"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"AmazonEKSWorkerNodePolicy"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Default")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"AmazonEC2ContainerRegistryReadOnly"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Default")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"AmazonDynamoDBReadOnlyAccess"),(0,l.kt)("td",{parentName:"tr",align:"left"},"DynamoDB\uc758 \uc815\ubcf4\ub97c \uc77d\uc5b4\uc640 \ub4f1\ub85d\ud558\uae30 \uc704\ud558\uc5ec \ud544\uc694\ud569\ub2c8\ub2e4.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"AmazonRDSReadOnlyAccess"),(0,l.kt)("td",{parentName:"tr",align:"left"},"RDS\uc758 \uc815\ubcf4\ub97c \uc77d\uc5b4\uc640 \ub4f1\ub85d\ud558\uae30 \uc704\ud558\uc5ec \ud544\uc694\ud569\ub2c8\ub2e4.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"AmazonEKS_CNI_Policy"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Default"))))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Node Group \uc0dd\uc131"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"EKS > Clusters > cluster \uc774\ub984 > Configuration > Compute > Add Node Group\uc744 \ud1b5\ud574 Node Group\uc744 \uc0dd\uc131\ud569\ub2c8\ub2e4."),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Add Node Group")),(0,l.kt)("p",{parentName:"li"},(0,l.kt)("img",{alt:"Public Zone",src:a(2269).Z,width:"971",height:"435"})),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\uc704\uc5d0\uc11c \uc0dd\uc131\ud55c IAM Policy\ub97c \uc9c0\uc815\ud574 \uc90d\ub2c8\ub2e4.")),(0,l.kt)("p",{parentName:"li"},(0,l.kt)("img",{alt:"Public Zone",src:a(6695).Z,width:"866",height:"1120"})),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\uad8c\uc7a5\ud558\ub294 Node Group\uc740 m5.large 6 instance \uc774\uc0c1\uc758 \uad6c\uc131\uc785\ub2c8\ub2e4.")),(0,l.kt)("p",{parentName:"li"},(0,l.kt)("img",{alt:"Public Zone",src:a(6652).Z,width:"861",height:"965"})))))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"AWS Load Balancer Controller \uc124\uce58"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"alb \uc0ac\uc6a9\uc744 \uc704\ud558\uc5ec \ub2e4\uc74c\uc758 \uc124\uce58\ub97c \uad8c\uc7a5\ud569\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ul"},"\uc9c1\uc811 alb\ub97c \uc6b4\uc601\ud558\uc2dc\ub294 \uacbd\uc6b0 sticky option")),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-html"},"https://github.com/kubernetes-sigs/aws-load-balancer-controller\n")),(0,l.kt)("p",{parentName:"li"},(0,l.kt)("a",{parentName:"p",href:"https://kubernetes-sigs.github.io/aws-load-balancer-controller/latest/deploy/installation/"},"Load Balancer Controller Installation")," \uc744 \ucc38\uace0\ud574\uc8fc\uc2ed\uc2dc\uc624."),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"cluster\ub97c \uc9c1\uc811 \uc0dd\uc131\ud55c \uacbd\uc6b0 subnet auto discovery\ub97c \uc704\ud558\uc5ec subnets\uc5d0 tagging\uc744 \ud574\uc8fc\uc5b4\uc57c\ud558\ub294 \uacbd\uc6b0\uac00 \uc788\uc2b5\ub2c8\ub2e4.\n\ub2e4\uc74c \ub9c1\ud06c\ub97c \ucc38\uc870\ud558\uc5ec tagging\uc744 \ud574\uc8fc\uc2ed\uc2dc\uc624.\n")),(0,l.kt)("p",{parentName:"li"},(0,l.kt)("a",{parentName:"p",href:"https://aws.amazon.com/ko/premiumsupport/knowledge-center/eks-vpc-subnet-discovery"},"auto subnet discovery")),(0,l.kt)("p",{parentName:"li"},(0,l.kt)("img",{alt:"Public Zone",src:a(6268).Z,width:"795",height:"366"})))),(0,l.kt)("h2",{id:"8-gke-setting"},"8. GKE \uc124\uc815"),(0,l.kt)("h3",null,"8.1 Prerequisites"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"QueryPie\ub97c GCP\uc0c1\uc5d0\uc11c \ud6a8\uc728\uc801\uc73c\ub85c \uc124\uce58\ud558\uace0 \ucd5c\uc2e0\uc73c\ub85c \uc720\uc9c0\ud558\ub294 \ubc29\ubc95\uc740 GKE\uc0c1\uc5d0\uc11c \uc6b4\uc601\ud558\ub294 \uac83\uc785\ub2c8\ub2e4.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("a",{parentName:"p",href:"https://cloud.google.com/sdk/docs/install"},"Google Cloud SDK")," \ub97c \uba3c\uc800 \uc124\uce58\ud574\uc8fc\uc2ed\uc2dc\uc624.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"kubernetes api\ub97c enable \ud574\uc8fc\uc2ed\uc2dc\uc624."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"gcloud services enable container.googleapis.com\n"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"IAM Service Account Credentials api\ub97c enable \ud574\uc8fc\uc2ed\uc2dc\uc624."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"}," gcloud services enable iamcredentials.googleapis.com\n"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"sqladmin api \ub97c enable \ud574\uc8fc\uc2ed\uc2dc\uc624."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"gcloud services enable sqladmin.googleapis.com\n"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\ub2e4\uc74c\uc758 \uad8c\ud55c\ub4e4\uc774 \ud544\uc694\ud569\ub2c8\ub2e4."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"container.clusters.create\ncontainer.clusters.update\niam.serviceAccounts.setIamPolicy\n")))),(0,l.kt)("h3",null,"8.2 Project \uc0dd\uc131"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\uc774\ubbf8 project\uac00 \uc0dd\uc131\ub418\uc5b4 \uc788\ub2e4\uba74 \uc774 \uacfc\uc815\uc740 \uc0dd\ub7b5\ud574\uc8fc\uc2ed\uc2dc\uc624."),(0,l.kt)("pre",null,(0,l.kt)("code",{lang:"shell script"},"gcloud projects create ",(0,l.kt)("b",null,"PROJECT_ID")," --organization=",(0,l.kt)("b",null,"RGANIZATION_ID"))),(0,l.kt)("p",{parentName:"li"},"\uc608\uc81c)."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"gcloud projects create querypie --organization=614642268215\n")))),(0,l.kt)("h3",null,"8.3 GKE Cluster \uc0dd\uc131"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\uc774\ubbf8 cluster\uac00 \uc0dd\uc131\ub418\uc5b4 \uc788\ub2e4\uba74 \uc774 \uacfc\uc815\uc740 \uc0dd\ub7b5\ud574\uc8fc\uc2ed\uc2dc\uc624."),(0,l.kt)("pre",null,(0,l.kt)("code",{lang:"shell script"},"gcloud container clusters create querypie --zone ",(0,l.kt)("b",null,"ZONE_ID")," --project ",(0,l.kt)("b",null,"PROJECT_ID")," --workload-pool=",(0,l.kt)("b",null,"PROJECT_ID"),".svc.id.goog --workload-metadata=GKE_METADATA")),(0,l.kt)("p",{parentName:"li"},"\uc608\uc81c)."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"gcloud container clusters create querypie --zone asia-northeast3-a --project chequer --workload-pool=querypie.svc.id.goog --workload-metadata=GKE_METADATA\n"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\uc0dd\uc131\ub41c cluster\ub294 \ub2e4\uc74c\uacfc \uac19\uc774 \ud655\uc778\uc774 \uac00\ub2a5\ud569\ub2c8\ub2e4."),(0,l.kt)("p",{parentName:"li"}," \uc608\uc81c)."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"gcloud container clusters describe querypie --zone 'asia-northeast3-a'\n"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"cluster\uc640 \ud1b5\uc2e0\ud558\uae30 \uc704\ud558\uc5ec kubectl \uc744 \uad6c\uc131\ud569\ub2c8\ub2e4."),(0,l.kt)("p",{parentName:"li"}," \uc608\uc81c)."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"gcloud container clusters get-credentials querypie --zone asia-northeast3-a --project querypie\n")))),(0,l.kt)("h3",null,"8.4 Google Service Account \uc0dd\uc131"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"google service account\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{lang:"shell"},"gcloud iam service-accounts create ",(0,l.kt)("b",null,"GSA_NAME"))),(0,l.kt)("p",{parentName:"li"}," \uc608\uc81c)."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"gcloud iam service-accounts create querypie\n"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"google service account\ub97c \ub9cc\ub4e4\uace0 \uc774\ub97c kubernetes\uc758 service account\uac00 google service account\ub85c \ub3d9\uc791\ud558\ub3c4\ub85d \ud5c8\uc6a9\ud569\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{lang:"shell"},'gcloud iam service-accounts add-iam-policy-binding \\ --role roles/iam.workloadIdentityUser \\ --member "serviceAccount:querypie.svc.id.goog[',(0,l.kt)("b",null,"K8S_NAMESPACE"),"/",(0,l.kt)("b",null,"KSA_NAME"),']" \\',(0,l.kt)("b",null,"GSA_NAME"),"@",(0,l.kt)("b",null,"PROJECT_ID"),".iam.gserviceaccount.com")),(0,l.kt)("p",{parentName:"li"},"\uc608\uc81c).")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\uae30\uc874\uc5d0 \uc124\uce58\ub41c querypie\uac00 \uc788\ub2e4\uba74 \ub2e4\uc74c\uacfc \uac19\uc774 kubernetes \uc758 service account\uc5d0 annotation\uc744 \ucd94\uac00\ud574\uc90d\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{lang:"shell"},"kubectl annotate serviceaccount \\ --namespace ",(0,l.kt)("b",null,"K8S_NAMESPACE")," \\",(0,l.kt)("b",null,"KSA_NAME")," \\ iam.gke.io/gcp-service-account=GSA_NAME@PROJECT_ID.iam.gserviceaccount.com")),(0,l.kt)("p",{parentName:"li"},"\uc608\uc81c)."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl annotate serviceaccount \\\n--namespace <b>querypie</b> \\\n<b>querypie</b> \\\niam.gke.io/gcp-service-account=querypie@querypie.iam.gserviceaccount.com\n")))),(0,l.kt)("h3",null,"8.5. Tips"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\ub2e4\uc74c\uc744 \ubbf8\ub9ac \ud658\uacbd\ubcc0\uc218\uc5d0 \uc9c0\uc815\ud574 \ub450\uc2dc\uba74 ZONE, CLUSTER, PROJECT\ub97c \ub9e4\ubc88 gcloud\uc758 parameter\ub85c \ub118\uae30\uc9c0 \uc54a\uc73c\uc154\ub3c4 \ub429\ub2c8\ub2e4."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},' export PROJECT=$(gcloud config list project --format "value(core.project)" )\n export CLUSTER=workload-id\n export ZONE=asia-northeast3-a\n gcloud config set compute/zone $ZONE\n gcloud config set compute/region asia-northeast3-a\n')))),(0,l.kt)("h2",null,"9. Docker Compose\ub97c \uc774\uc6a9\ud55c Deploy"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\uac04\ub2e8\ud558\uac8c \ub2e8\uc77c VM\uc5d0 \ub744\uc6cc\uc11c \uc6b4\uc601\ud558\uae30 \uc704\ud574\uc11c\ub294 docker-compose\ub97c \uc0ac\uc6a9\ud558\uc2dc\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"VM\uc740 \ucd5c\uc18c 4Core, 16GB \uc774\uc0c1\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4.  ")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"docker \ub294 20.10.x \uc774\uc0c1\uc744 \uad8c\uc7a5\ud574\ub4dc\ub9bd\ub2c8\ub2e4.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\ub2e4\uc74c\uc740 docker-compose.yml\uc758 \uc608\uc81c\uc785\ub2c8\ub2e4. \ub2e4\uc74c \ubcc0\uc218\ub4e4\uc744 \ud658\uacbd\uc5d0 \ub9de\uac8c \uc870\uc815\ud574\uc8fc\uc2ed\uc2dc\uc624.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\ucc38\uace0 file\uc744 \uc5d0 \uc62c\ub824\ub461\ub2c8\ub2e4. ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/chequer-io/querypie-deployment/raw/master/docker-compose/docker-compose-example.zip"},"\uc608\uc81c \ud30c\uc77c")),(0,l.kt)("table",{parentName:"li"},(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:"left"},"Policy"),(0,l.kt)("th",{parentName:"tr",align:"left"},"\ube44\uace0"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"redis_password"),(0,l.kt)("td",{parentName:"tr",align:"left"},"redis password (\uc5c6\ub294 \uacbd\uc6b0 \uacf5\ubc31)")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"db_host"),(0,l.kt)("td",{parentName:"tr",align:"left"},"querypie backend db\uc758 \ud638\uc2a4\ud2b8")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"db_username"),(0,l.kt)("td",{parentName:"tr",align:"left"},"querypie backend db\uc758 username")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"db_password"),(0,l.kt)("td",{parentName:"tr",align:"left"},"querypie backend db\uc758 password")))),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'version: "3.9"\n\nvolumes:\n  redis_data:\n    driver: local\n\nservices:\n  redis-server:\n    image: \'dockerpie.querypie.com/chequer.io/redis:6.0-debian-10\'\n    healthcheck:\n      test: [ "CMD", "redis-cli", "-a","${redis_password}", "ping" ]\n      interval: 1s\n      timeout: 3s\n      retries: 30\n    environment:\n      - ALLOW_EMPTY_PASSWORD=no\n      - REDIS_DISABLE_COMMANDS=FLUSHDB,FLUSHALL\n      - REDIS_PASSWORD=${redis_password}\n      - REDIS_AOF_ENABLED=no\n    command: /opt/bitnami/scripts/redis/run.sh --maxmemory 1024mb\n    ports:\n      - \'6379:6379\'\n    volumes:\n      - redis_data:/redis/data\n\n  querypie-api:\n    depends_on:\n      db:\n        condition: service_started\n    image: dockerpie.querypie.com/chequer.io/querypie-api:8.4.1\n    healthcheck:\n      test: ["CMD", "wget", "-nv", "http://localhost:8080/health"]\n      start_period: 120s\n      interval: 5s\n      timeout: 3s\n      retries: 5\n    ports:\n      - 8080:80\n    environment:\n      - DB_DRIVER_CLASS=com.mysql.cj.jdbc.Driver\n      - DB_JDBC_URL=jdbc:mysql://${db_host}:3306/querypie?useSSL=false&autoReconnect=true&validationQuery=select 1&useUnicode=true&characterEncoding=UTF-8&allowPublicKeyRetrieval=true&serverTimezone=UTC\n      - DB_USERNAME=${db_username}\n      - DB_PASSWORD=${db_password}\n      - DB_MAX_CONNECTION_SIZE=30\n\n  querypie-app:\n    depends_on:\n      redis-server:\n        condition: service_healthy\n    image: dockerpie.querypie.com/chequer.io/querypie-app:8.4.1\n    ports:\n      - 3000:3000\n    environment:\n      - PORT=3000\n      - NODE_ENV=production\n      - APP_ENV=master\n      - API_URL=http://querypie-api:8080\n      - REDIS_HOST=redis-server\n      - REDIS_PORT=6379\n      - REDIS_PASSWORD=${redis_password}\n      - REDIS_EVENTKEY=master\n      - REDIS_DB=0\n      - TZ=Asia/Seoul\n    links:\n      - querypie-api\n\n  querypie-nginx:\n    image: dockerpie.querypie.com/chequer.io/nginx:1.19.8\n    volumes:\n      - ./nginx/nginx.conf:/etc/nginx/nginx.conf\n    ports:\n      - 80:80\n    links:\n      - querypie-app\n')))),(0,l.kt)("h2",null,"10. QueryPie Proxy Server (aka. ARiSA)"),(0,l.kt)("h3",null,"10.1 Brief Architecture"),"* Install (Deploy) \uc744 \uc704\ud55c \uac04\ub2e8\ud55c \uad6c\uc870\ub97c \uc124\uba85\ud569\ub2c8\ub2e4.",(0,l.kt)("p",null,"  ",(0,l.kt)("img",{alt:"Public Zone",src:a(1340).Z,width:"962",height:"725"})),(0,l.kt)("h3",null,"10.2 Components"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:"left"},"Policy"),(0,l.kt)("th",{parentName:"tr",align:"left"},"\ube44\uace0"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"Proxy Server (Proxy)"),(0,l.kt)("td",{parentName:"tr",align:"left"},"\ud074\ub77c\uc774\uc5b8\ud2b8\ub85c \ubd80\ud130 \uc5f0\uacb0\uc744 \ubc1b\uc544 API\uc11c\ubc84\uc640 \ud1b5\uc2e0\ud558\uc5ec \uc815\ucc45\uc744 \uc801\uc6a9\ud558\uc5ec DB \uc11c\ubc84\ub85c \ud328\ud0b7\uc744 \uc804\ub2ec\ud569\ub2c8\ub2e4.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"Proxy Client (OTL)"),(0,l.kt)("td",{parentName:"tr",align:"left"},"DB\uc11c\ubc84\uc640 \uac19\uc740 Zone\uc5d0 \uc874\uc7ac\ud558\uba70 Outboud \ud1b5\uc2e0\uc744 \uc704\ud55c Client\uc785\ub2c8\ub2e4.")))),(0,l.kt)("h3",null,"10.3 Proxy Server Install"),"* docker-compose \ub85c \uc124\uce58\ud558\ub294 \uac83\uc744 \uad8c\uc7a5 \ub4dc\ub9bd\ub2c8\ub2e4.",(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"```yaml\nversion: '3'\narisa:\n  image: dockerpie.querypie.com/chequer.io/querypie-app:alpha\n  environment:\n    - PORT=3000\n    - NODE_ENV=production\n    - APP_ENV=alpha\n    - ARISA_DEDICATED=true\n    - API_URL=https://api.querypie.com\n    - ARISA_PORT_START=40000\n    - ARISA_PORT_END=40200\n    - OTL_SERVER_PORT1=6000\n    - OTL_SERVER_PORT2=7000\n    restart: unless-stopped\n```\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\ud658\uacbd\ubcc0\uc218 \uc124\uba85 "),(0,l.kt)("table",{parentName:"li"},(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:"left"},"Policy"),(0,l.kt)("th",{parentName:"tr",align:"left"},"\ube44\uace0"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"ARISA_PORT_START"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Proxy Server \uc758 Port Range\uc758 Start")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"ARISA_PORT_END"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Proxy Server \uc758 Port Range\uc758 End")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"OTL_SERVER_PORT1"),(0,l.kt)("td",{parentName:"tr",align:"left"},"\uc5f0\uacb0 \uc218\ub9bd\uc744 \uc704\ud55c https \ud504\ub85c\ud1a0\ucf5c\uc744 \uc704\ud55c port")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"OTL_SERVER_PORT2"),(0,l.kt)("td",{parentName:"tr",align:"left"},"\ub370\uc774\ud130 \uc804\uc1a1\uc744 \uc704\ud55c port")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"API_URL"),(0,l.kt)("td",{parentName:"tr",align:"left"},"querypie backend api server\uc758 url")))))),(0,l.kt)("h3",null,"10.4 Proxy Client Install"),"* docker-compose \ub85c \uc124\uce58\ud558\ub294 \uac83\uc744 \uad8c\uc7a5 \ub4dc\ub9bd\ub2c8\ub2e4.",(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'```yaml\nversion: "3"\n\nservices:\n  arisa:\n    image: dockerpie.querypie.com/chequer.io/arisa-otl:alpha\n    environment:\n      - OTL_SERVER_HOST=alpha-proxy.querypie.com\n      - OTL_SERVER_PORT1=6000\n      - OTL_SERVER_PORT2=7000\n      - OTL_NETWORK_IDS=06f80a7b8c4fb747a\n      - OTL_NETWORK_CIDRS=172.10.0.0/16\n```\n')),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:"left"},"Policy"),(0,l.kt)("th",{parentName:"tr",align:"left"},"\ube44\uace0"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"OTL_SERVER_HOST"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Proxy Server\uc758 \uc8fc\ub85c\ub97c \uac00\ub9ac\ud0b5\ub2c8\ub2e4. (10\uc7a5 \ucc38\uace0)")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"OTL_SERVER_PORT1"),(0,l.kt)("td",{parentName:"tr",align:"left"},"\uc5f0\uacb0 \uc218\ub9bd\uc744 \uc704\ud55c https \ud504\ub85c\ud1a0\ucf5c\uc744 \uc704\ud55c port")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"OTL_SERVER_PORT2"),(0,l.kt)("td",{parentName:"tr",align:"left"},"\ub370\uc774\ud130 \uc804\uc1a1\uc744 \uc704\ud55c port")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"OTL_NETWORK_IDS"),(0,l.kt)("td",{parentName:"tr",align:"left"},"DB\uc11c\ubc84\uac00 \uc704\uce58\ud558\ub294 VPC\uc758 ID\ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"OTL_NETWORK_CIDRS"),(0,l.kt)("td",{parentName:"tr",align:"left"},"DB\uc11c\ubc84\uac00 \uc704\uce58\ud558\ub294 CIDRS\ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4.")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Proxy Server\ub97c \ud1b5\ud558\uc5ec DB\uc5d0 \uc811\uadfc\ud558\ub294 \uacbd\uc6b0 Proxy\uac00 OTL Client\ub97c \ucc3e\uc544\uac00\ub294 \ubc29\ubc95\uc740")),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"DB\uc11c\ubc84\uc758 metadata\uc5d0 \uc800\uc7a5\ub41c NETWORK_ID"),(0,l.kt)("li",{parentName:"ol"},"DB\uc11c\ubc84\uc758 CIDRS\n\uc758 \uc21c\uc11c\ub85c \ucc3e\uc544\uac11\ub2c8\ub2e4.")))}k.isMDXComponent=!0},1340:function(e,t,a){t.Z=a.p+"assets/images/ARiSA-7fd6c34b70805d07b00510e2f4858767.png"},6268:function(e,t,a){t.Z=a.p+"assets/images/auto_subnet_tagging-c3e5745deacfdedad9d8cd70f714fbbf.png"},6681:function(e,t,a){t.Z=a.p+"assets/images/cluster_1-14b46ddfcd7ed175969e176984f99022.png"},5878:function(e,t,a){t.Z=a.p+"assets/images/cluster_2-067166b5ed88c812e2749794654c51d2.png"},9847:function(e,t,a){t.Z=a.p+"assets/images/cluster_3-eb038839ac06a0ce27c08084fcea2157.png"},9814:function(e,t,a){t.Z=a.p+"assets/images/cluster_4-2f1e5fcdf20e7d15311e22da24664e37.png"},3054:function(e,t,a){t.Z=a.p+"assets/images/deploy_arch_1-bed914098369071916b66c11bbecfc84.png"},3615:function(e,t,a){t.Z=a.p+"assets/images/deploy_arch_2-66048eca3ea25476e306e758c2999d74.png"},3892:function(e,t,a){t.Z=a.p+"assets/images/iam_1-d172f7bc13c81211be89395468b65e68.png"},3954:function(e,t,a){t.Z=a.p+"assets/images/iam_2-ae89e02ab6f32c23e20bf512405aef94.png"},3625:function(e,t,a){t.Z=a.p+"assets/images/iam_3-5a1ce5948195477f7f4e1b3ee172e6c6.png"},3388:function(e,t,a){t.Z=a.p+"assets/images/iam_4-a4f8132ab53e0d014d446eb73db3b701.png"},2269:function(e,t,a){t.Z=a.p+"assets/images/node_group_1-fdddf9f2ff27a174d527e64e28d3ecf6.png"},6695:function(e,t,a){t.Z=a.p+"assets/images/node_group_2-183aeafbeb02b13f8846fc813136edcd.png"},6652:function(e,t,a){t.Z=a.p+"assets/images/node_group_3-244d8b1e86fda7f9a9726d7533db3d86.png"}}]);